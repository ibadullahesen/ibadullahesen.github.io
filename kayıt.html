<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axtarget Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; height: 100vh; overflow: hidden; margin: 0; display: flex; align-items: center; justify-content: center; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .webcam-preview { width: 120px; height: 90px; border-radius: 8px; border: 2px solid #3b82f6; position: absolute; z-index: 50; object-fit: cover; transition: 0.3s; }
        .pos-bottom-left { bottom: 10px; left: 10px; }
        .pos-bottom-right { bottom: 10px; right: 10px; }
        .quality-btn.active { background: #3b82f6; border-color: #60a5fa; }
    </style>
</head>
<body>

    <div class="relative w-full max-w-xl px-4">
        <div class="glass rounded-[20px] p-5 shadow-2xl relative">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Axtarget Studio</h1>
                    <p class="text-slate-500 text-[9px] tracking-widest uppercase">Compact v2.0</p>
                </div>
                <div id="status" class="hidden flex items-center gap-2 bg-red-500/20 text-red-400 px-2 py-0.5 rounded-full text-[9px] font-bold">
                    <span class="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"></span> REC <span id="timer">00:00</span>
                </div>
            </div>

            <div class="relative w-full aspect-video bg-slate-900 rounded-lg mb-4 border border-white/5 flex items-center justify-center overflow-hidden mx-auto">
                <video id="preview" class="w-full h-full object-contain hidden" controls></video>
                <div id="blank" class="text-slate-700 flex flex-col items-center">
                    <i class="fas fa-desktop text-2xl mb-2 opacity-20"></i>
                    <p class="text-[10px] italic opacity-40 font-medium">Video gözlənilir...</p>
                </div>
                <video id="webcam" class="webcam-preview hidden pos-bottom-right" autoplay muted></video>
            </div>

            <div class="flex items-center gap-2">
                <button id="record-btn" class="flex-[3] bg-blue-600 hover:bg-blue-500 py-2.5 rounded-lg font-bold text-xs flex items-center justify-center gap-2 transition-all shadow-lg shadow-blue-900/20">
                    <i class="fas fa-circle text-[6px]"></i> Ekranı Kaydet
                </button>
                <button id="stop-btn" class="hidden flex-[3] bg-red-600 hover:bg-red-500 py-2.5 rounded-lg font-bold text-xs flex items-center justify-center gap-2 transition-all">
                    <i class="fas fa-stop text-[6px]"></i> Durdur
                </button>
                <button id="settings-toggle" class="flex-1 h-9 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg flex items-center justify-center transition-all">
                    <i class="fas fa-cog text-xs"></i>
                </button>
            </div>

            <div id="result-btns" class="hidden mt-3 flex gap-2">
                <button id="download-btn" class="flex-1 bg-emerald-600 hover:bg-emerald-500 py-2 rounded-lg font-bold text-[10px]">Videonun Yüklə</button>
                <button id="delete-btn" class="w-10 h-8 bg-white/5 hover:bg-red-500/20 border border-white/10 rounded-lg text-xs flex items-center justify-center"><i class="fas fa-trash"></i></button>
            </div>
        </div>
    </div>

    <div id="settings-panel" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="glass w-full max-w-xs rounded-[16px] p-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-sm font-bold">Ayarlar</h2>
                <button id="close-settings" class="text-slate-400 hover:text-white"><i class="fas fa-times text-xs"></i></button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="text-[9px] text-slate-500 font-bold uppercase mb-2 block tracking-wider">Keyfiyyət</label>
                    <div class="grid grid-cols-2 gap-1.5">
                        <button class="quality-btn p-1.5 border border-white/10 rounded-md text-[10px]" data-val="2160">4K</button>
                        <button class="quality-btn p-1.5 border border-white/10 rounded-md text-[10px]" data-val="1440">2K</button>
                        <button class="quality-btn active p-1.5 border border-white/10 rounded-md text-[10px]" data-val="1080">1080p</button>
                        <button class="quality-btn p-1.5 border border-white/10 rounded-md text-[10px]" data-val="720">720p</button>
                    </div>
                </div>

                <div class="flex items-center justify-between p-2 bg-white/5 rounded-md border border-white/10">
                    <span class="text-[11px]">Veb-kamera</span>
                    <input type="checkbox" id="cam-check" class="w-3.5 h-3.5 accent-blue-500 cursor-pointer">
                </div>

                <div id="cam-pos-box" class="hidden grid grid-cols-2 gap-1.5">
                    <button id="pos-left" class="p-1.5 bg-white/5 border border-white/10 rounded-md text-[9px]">Sol Aşağı</button>
                    <button id="pos-right" class="p-1.5 bg-blue-600 border border-blue-500 rounded-md text-[9px]">Sağ Aşağı</button>
                </div>

                <div class="flex items-center justify-between p-2 bg-white/5 rounded-md border border-white/10">
                    <span class="text-[11px]">Mikrofon Səsi</span>
                    <input type="checkbox" id="mic-check" checked class="w-3.5 h-3.5 accent-blue-500 cursor-pointer">
                </div>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder, chunks = [], timer, start, mStream, wStream, quality = 1080;

        const btnRec = document.getElementById('record-btn'), btnStop = document.getElementById('stop-btn');
        const setPanel = document.getElementById('settings-panel'), setToggle = document.getElementById('settings-toggle');
        const camCheck = document.getElementById('cam-check'), vWebcam = document.getElementById('webcam');

        setToggle.onclick = () => setPanel.classList.remove('hidden');
        document.getElementById('close-settings').onclick = () => setPanel.classList.add('hidden');

        document.querySelectorAll('.quality-btn').forEach(b => {
            b.onclick = () => {
                document.querySelectorAll('.quality-btn').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                quality = parseInt(b.dataset.val);
            }
        });

        camCheck.onchange = async () => {
            if (camCheck.checked) {
                try {
                    wStream = await navigator.mediaDevices.getUserMedia({ video: true });
                    vWebcam.srcObject = wStream;
                    vWebcam.classList.remove('hidden');
                    document.getElementById('cam-pos-box').classList.remove('hidden');
                } catch { camCheck.checked = false; }
            } else {
                if (wStream) wStream.getTracks().forEach(t => t.stop());
                vWebcam.classList.add('hidden');
                document.getElementById('cam-pos-box').classList.add('hidden');
            }
        };

        const updateCamPos = (side) => {
            vWebcam.className = `webcam-preview pos-bottom-${side}`;
            document.getElementById('pos-left').classList.toggle('bg-blue-600', side === 'left');
            document.getElementById('pos-right').classList.toggle('bg-blue-600', side === 'right');
        };

        document.getElementById('pos-left').onclick = () => updateCamPos('left');
        document.getElementById('pos-right').onclick = () => updateCamPos('right');

        btnRec.onclick = async () => {
            try {
                const sStream = await navigator.mediaDevices.getDisplayMedia({
                    video: { width: { ideal: (quality * 16) / 9 }, height: { ideal: quality } },
                    audio: true
                });
                let tracks = [...sStream.getTracks()];
                if (document.getElementById('mic-check').checked) {
                    try {
                        const m = await navigator.mediaDevices.getUserMedia({ audio: true });
                        tracks = [...tracks, ...m.getAudioTracks()];
                    } catch {}
                }
                mStream = new MediaStream(tracks);
                mediaRecorder = new MediaRecorder(mStream, { mimeType: 'video/webm;codecs=vp9' });
                chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const b = new Blob(chunks, { type: 'video/webm' });
                    document.getElementById('preview').src = URL.createObjectURL(b);
                    document.getElementById('preview').classList.remove('hidden');
                    document.getElementById('blank').classList.add('hidden');
                    document.getElementById('result-btns').classList.remove('hidden');
                    document.getElementById('status').classList.add('hidden');
                    btnStop.classList.add('hidden');
                    btnRec.classList.remove('hidden');
                    clearInterval(timer);
                    mStream.getTracks().forEach(t => t.stop());
                };
                mediaRecorder.start();
                btnRec.classList.add('hidden');
                btnStop.classList.remove('hidden');
                document.getElementById('status').classList.remove('hidden');
                document.getElementById('result-btns').classList.add('hidden');
                start = Date.now();
                timer = setInterval(() => {
                    const d = new Date(Date.now() - start);
                    document.getElementById('timer').textContent = d.toISOString().substr(14, 5);
                }, 1000);
                sStream.getVideoTracks()[0].onended = () => mediaRecorder.stop();
            } catch {}
        };

        btnStop.onclick = () => mediaRecorder.stop();
        document.getElementById('delete-btn').onclick = () => {
            document.getElementById('preview').src = "";
            document.getElementById('preview').classList.add('hidden');
            document.getElementById('blank').classList.remove('hidden');
            document.getElementById('result-btns').classList.add('hidden');
        };
        document.getElementById('download-btn').onclick = () => {
            const a = document.createElement('a');
            a.href = document.getElementById('preview').src;
            a.download = 'record.webm';
            a.click();
        };
    </script>
</body>
</html>
