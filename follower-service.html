<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TakipÃ§i XidmÉ™ti</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Koyu arka plan */
            color: #e2e8f0; /* AÃ§Ä±k gri metin */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex-grow: 1;
            padding-bottom: 80px; /* Footer yÃ¼ksekliÄŸi kadar boÅŸluk */
        }
        .container {
            max-width: 500px; /* Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ne gÃ¶re daha dar bir konteyner */
            margin: 0 auto;
            padding: 1.5rem;
        }
        .card {
            background-color: #2d3748; /* Kart arka planÄ± */
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #4a5568;
        }
        .input-field, .select-field {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #4a5568;
            color: #e2e8f0;
            border: 1px solid #6b7280;
            outline: none; /* OdaklandÄ±ÄŸÄ±nda dÄ±ÅŸ Ã§izgiyi kaldÄ±r */
        }
        .input-field:focus, .select-field:focus {
            ring: 2px;
            ring-color: #34d399; /* YeÅŸil vurgu */
            border-color: #34d399;
        }
        .button-primary {
            background-color: #34d399; /* YeÅŸil dÃ¼ÄŸme */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        .button-primary:hover:not(:disabled) {
            background-color: #10b981;
        }
        .button-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .balance-section {
            background-color: #2d3748;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #10b981;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .balance-section button {
            background-color: #f97316; /* Turuncu dÃ¼ÄŸme */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        .balance-section button:hover {
            background-color: #ea580c;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2d3748;
            border-top: 1px solid #4a5568;
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #a0aec0; /* Gri ikon ve metin */
            font-size: 0.8rem;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        .nav-item:hover, .nav-item.active {
            color: #34d399; /* YeÅŸil vurgu */
        }
        .alert-message {
            position: fixed;
            bottom: 80px; /* Footer'Ä±n Ã¼stÃ¼nde gÃ¶rÃ¼nmesi iÃ§in */
            left: 50%;
            transform: translateX(-50%);
            background-color: #dc2626;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            min-width: 300px;
            text-align: center;
        }
        .alert-message.show {
            opacity: 1;
        }
        /* Balans ArtÄ±r Modal Stilleri */
        .modal {
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            /* ModalÄ± baÅŸlanÄŸÄ±cda gizli saxlayÄ±n */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #2d3748;
            margin: auto;
            padding: 20px;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #e2e8f0;
        }
        .payment-card-image {
            width: 100%;
            max-width: 250px;
            margin: 0 auto 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .description-box {
            background-color: #2d3748;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #4a5568;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .description-box h4 {
            font-weight: bold;
            color: #34d399;
            margin-bottom: 0.75rem;
        }
        .description-box ul {
            list-style: none;
            padding: 0;
            margin-bottom: 1rem;
        }
        .description-box ul li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: flex-start;
        }
        .description-box ul li strong {
            color: #e2e8f0;
            flex-shrink: 0;
            margin-right: 0.5rem;
        }
        .description-box p.note {
            font-style: italic;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }
        .description-box p.note span {
            color: #f97316; /* Turuncu vurgu */
        }
        /* Floating WhatsApp Bubble */
        #floating-whatsapp-bubble {
            position: fixed;
            bottom: 100px; /* Footer'Ä±n Ã¼stÃ¼nde */
            right: 20px;
            background-color: #25D366; /* WhatsApp yeÅŸili */
            color: white;
            padding: 15px;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #floating-whatsapp-bubble:hover {
            transform: scale(1.1);
        }
        /* Styles for category icons in select options */
        .select-field option {
            display: flex;
            align-items: center;
        }
        /* New styles for the Campaigns section */
        .campaign-banner {
            background-image: linear-gradient(to right top, #38b2ac, #5fe4a0);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem; /* Add margin-top to separate from previous section */
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 8px 15px rgba(0,0,0,0.3);
            animation: pulse 2s infinite cubic-bezier(0.66, 0, 0, 1);
            border: 2px solid #5fe4a0;
        }
        .campaign-banner h3 {
            font-size: 1.75rem; /* Larger font for heading */
            margin-bottom: 0.75rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        .campaign-banner p {
            font-size: 1.1rem;
            line-height: 1.5;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 8px 15px rgba(0,0,0,0.3); }
            50% { transform: scale(1.02); box-shadow: 0 12px 20px rgba(0,0,0,0.4); }
            100% { transform: scale(1); box-shadow: 0 8px 15px rgba(0,0,0,0.3); }
        }
    </style>
</head>
<body>

    <header class="bg-gray-900 shadow-lg py-4 fixed w-full top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <a href="index.html" class="text-white text-2xl font-bold tracking-wide">AxtarGet</a>
            <div class="flex items-center space-x-4">
                <a href="#campaigns-section" id="header-campaigns-button" class="text-white text-sm font-semibold py-1 px-3 rounded-full bg-blue-600 hover:bg-blue-700 transition-colors duration-200">Kampaniyalar</a>
                <span class="text-xl font-semibold">
                    <i class="fas fa-users mr-2 text-blue-400"></i>TakipÃ§i XidmÉ™ti
                    <!-- Ä°stifadÉ™Ã§i sayÄ± elementi buradan silindi -->
                </span>
            </div>
        </div>
    </header>

    <div class="main-content pt-20">
        <div class="container">
            <div class="balance-section">
                <div class="flex flex-col items-start">
                    <span>BalansÄ±n: <span id="user-balance">0.0000 AZN</span></span>
                    <span class="text-sm text-gray-400 mt-1">Ä°stifadÉ™Ã§i ID: <span id="user-id-display">YÃ¼klÉ™nir...</span></span>
                </div>
                <button id="top-up-button">Balans ArtÄ±r</button>
            </div>

            <div class="card space-y-4">
                <div>
                    <label for="category-select" class="block text-gray-400 text-sm font-bold mb-2">Kateqori</label>
                    <select id="category-select" class="select-field">
                        <option value="">Kateqoriya SeÃ§in</option>
                    </select>
                </div>

                <div>
                    <label for="service-select" class="block text-gray-400 text-sm font-bold mb-2">Servis</label>
                    <select id="service-select" class="select-field" disabled>
                        <option value="">Servis SeÃ§in</option>
                    </select>
                </div>

                <div>
                    <label for="link-input" class="block text-gray-400 text-sm font-bold mb-2">Link</label>
                    <input type="text" id="link-input" placeholder="Link daxil edin" class="input-field">
                </div>

                <div>
                    <label for="quantity-input" class="block text-gray-400 text-sm font-bold mb-2">Miqdar</label>
                    <input type="text" id="quantity-input" placeholder="Minimum: 10 - Maksimum: 10 000 000" class="input-field">
                    <p class="text-xs text-gray-500 mt-1">Minimum: <span id="min-quantity">0</span> - Maksimum: <span id="max-quantity">0</span></p>
                </div>

                <div>
                    <label for="avg-time-input" class="block text-gray-400 text-sm font-bold mb-2">Ortalama sÃ¼re</label>
                    <input type="text" id="avg-time-input" class="input-field" readonly>
                </div>

                <div>
                    <label for="price-input" class="block text-gray-400 text-sm font-bold mb-2">QiymÉ™t</label>
                    <input type="text" id="price-input" class="input-field" readonly>
                </div>

                <button id="place-order-button" class="button-primary w-full" disabled>SifariÅŸ OluÅŸtur</button>
            </div>

            <div class="description-box card">
                <h4>XidmÉ™t HaqqÄ±nda QeydlÉ™r:</h4>
                <ul>
                    <li><strong>Min:</strong> <span id="desc-min-quantity"></span></li>
                    <li><strong>Max:</strong> <span id="desc-max-quantity"></span></li>
                    <li><strong>Link:</strong> KullanÄ±cÄ± AdÄ± veya Video Linki</li>
                    <li><strong>BaÅŸlama SÃ¼rÉ™ti:</strong> <span id="desc-avg-time"></span></li>
                    <li><strong>Telafi:</strong> BaÅŸlanÄŸÄ±c miqdardan aÅŸaÄŸÄ± olan sifariÅŸlÉ™r telafi edilmÉ™yÉ™cÉ™k..</li>
                </ul>
                <p class="note">
                    ğŸ“Œ XidmÉ™tin baÅŸlama sÃ¼rÉ™ti mÉ™ÅŸÄŸul vaxtlarda dÉ™yiÅŸir!
                </p>
                <p class="note">
                    ğŸ“Œ SifariÅŸiniz sistemdÉ™ tamamlanmazdan É™vvÉ™l <span>2. sipariÅŸi</span> vermeyiniz.
                </p>
            </div>

            <!-- Kampaniyalar BÃ¶lmÉ™si -->
            <div id="campaigns-section" class="campaign-banner">
                <h3>ğŸ“¢ Kampaniyalar! ğŸš€</h3>
                <p>
                    Tik-Tok **Takipci** - 1.99 azn<br>
                    10k Takipci cÉ™mi - 19.90 azn<br>
                    100k Takipci cÉ™mi - 199 azn<br>
                    1m Takipci cÉ™mi - 1999 azn
                </p>
            </div>
            <!-- Kampaniyalar BÃ¶lmÉ™si Sonu -->

        </div>
    </div>

    <footer class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Ana SÉ™hifÉ™</span>
        </a>
        <a href="#" class="nav-item active">
            <i class="fas fa-shopping-cart"></i>
            <span>Yeni SifariÅŸ</span>
        </a>
        <a href="orders.html" class="nav-item">
            <i class="fas fa-list-alt"></i>
            <span>SifariÅŸlÉ™r</span>
        </a>
        <a href="#" class="nav-item" id="bottom-nav-topup">
            <i class="fas fa-money-bill-wave"></i>
            <span>Balans É™lavÉ™ et</span>
        </a>
    </footer>

    <div id="alert-container"></div>

    <div id="top-up-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-top-up-modal">&times;</span>
            <h3 class="text-2xl font-bold text-white mb-4">Balans ArtÄ±r</h3>
            <img src="https://placehold.co/250x150/000000/ffffff?text=Kapital+Bank+Kart%C4%B1" alt="Kapital Bank KartÄ±" class="payment-card-image">
            <p class="text-lg text-white mb-2">Ã–dÉ™niÅŸ etmÉ™k Ã¼Ã§Ã¼n aÅŸaÄŸÄ±dakÄ± kart nÃ¶mrÉ™sinÉ™ pul gÃ¶ndÉ™rin:</p>
            <p class="text-2xl font-bold text-green-400 mb-4" id="bank-card-number">4169 7388 7208 5778</p>
            <p class="text-md text-gray-300 mb-4">
                Ã–dÉ™niÅŸ edildikdÉ™n sonra Ã§eki **060-600-61-62** nÃ¶mrÉ™sinin WhatsAppÄ±na atÄ±n.
                <br>5-15 dÉ™qiqÉ™ É™rzindÉ™ balansÄ±nÄ±z yÃ¼klÉ™nÉ™cÉ™k.
            </p>
           
            <p class="text-sm text-yellow-300 font-semibold mb-4 p-2 bg-yellow-900 bg-opacity-30 rounded-md">
                â•ğŸ 1-10 AZN balans artÄ±mÄ± Ã¼Ã§Ã¼n 1% <br>
                â•ğŸ’° 11-100 AZN arasÄ± balans artÄ±rma Ã¼Ã§Ã¼n 3% balans artÄ±mÄ± bizdÉ™n hÉ™diyyÉ™! <br>
                â•101+ balans artÄ±mÄ± Ã¼Ã§Ã¼n 6% balans artÄ±mÄ± bizdÉ™n!
            </p>
            
            <a id="whatsapp-topup-link" href="#" target="_blank" class="px-6 py-3 bg-green-600 text-white rounded-full font-semibold hover:bg-green-700 transition-colors duration-300 shadow-md inline-flex items-center">
                <i class="fab fa-whatsapp mr-2"></i> WhatsApp-a GÃ¶ndÉ™r
            </a>
        </div>
    </div>

    <a href="#" id="floating-whatsapp-bubble" class="fixed bottom-8 right-8 bg-green-600 text-white p-4 rounded-full shadow-lg cursor-pointer hover:bg-green-700 transition-colors duration-300 z-50" title="DÉ™stÉ™k Ã¼Ã§Ã¼n WhatsApp">
        <i class="fab fa-whatsapp text-3xl"></i>
    </a>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
        // Firebase konfiqurasiyasÄ±
        const firebaseConfig = {
            apiKey: "AIzaSyBEFLX4Uy4jTzoSyEdzYzOSEd2lqn8ifbE",
            authDomain: "axtargetbotwebsite.firebaseapp.com",
            projectId: "axtargetbotwebsite",
            storageBucket: "axtargetbotwebsite.firebasestorage.app", 
            messagingSenderId: "808698399196",
            appId: "1:808698399196:web:61b6be0721b94f24c3a719",
            measurementId: "G-VLWZG4Q5TD"
        };
        const firebaseProjectId = firebaseConfig.projectId;

        // Firebase'i BaÅŸlat
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Servis Verileri (allServices massivini É™n Ã¼stdÉ™ tÉ™yin etdim)
        const allServices = [
            {
                platform: 'Youtube',  
                category: 'ğŸ‘¥Youtube AbonÉ™Ã§i ServislÉ™ri',
                categoryIcon: '<i class="fab fa-youtube text-red-500 mr-2"></i>',
                items: [
                    { id: '00011', name: 'Youtube Xarici TakipÃ§i (Qaranti yoxdur)', icon: '<i class="fab fa-youtube text-red-500"></i>', avgTime: '80-120 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 3.12 },
                ]
            },
            {
                platform: 'Youtube',
                category: 'â¤ï¸Youtube BÉ™yÉ™ni ServislÉ™ri',
                categoryIcon: '<i class="fab fa-youtube text-red-500 mr-2"></i>',
                items: [
                    { id: '0005', name: 'Youtube BÉ™yÉ™ni â¤ï¸ |10M | BEST', icon: '<i class="fab fa-youtube text-red-500"></i>', avgTime: '15-25 dÉ™qiqÉ™', min: 30, max: 10000000, pricePerK: 0.39 },
                    { id: '0006', name: 'Youtube BÉ™yÉ™ni(Qarantili) â¤ï¸ |10M | BEST', icon: '<i class="fab fa-youtube text-red-500"></i>', avgTime: '15-25 dÉ™qiqÉ™', min: 30, max: 10000000, pricePerK: 0.97 },
                ]
            },
            {
                platform: 'Youtube',
                category: 'ğŸ‘ï¸â€ğŸ—¨ï¸Youtube Ä°zlÉ™nmÉ™ ServislÉ™ri',
                categoryIcon: '<i class="fab fa-youtube text-red-500 mr-2"></i>',
                items: [
                    { id: '0007', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸Youtube Ä°zlÉ™nmÉ™(Qaranti yoxdur)', icon: '<i class="fab fa-youtube text-red-500"></i>', avgTime: '16 saat', min: 30, max: 10000000, pricePerK: 1.97 },
                    { id: '0008', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸Youtube Ä°zlÉ™nmÉ™(Qarantiâœ…)', icon: '<i class="fab fa-youtube text-red-500"></i>', avgTime: '16 saat', min: 30, max: 10000000, pricePerK: 6.63 },
                ]
            },
            {
                platform: 'TikTok',
                category: 'ğŸ‘¥TikTok TakipÃ§i Servisleri',
                categoryIcon: '<i class="fab fa-tiktok text-white mr-2"></i>',
                items: [
                    { id: 'tiktok_foreign_follower', name: 'ğŸ‘¥TikTok Xarici TakipÃ§i', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '60-90 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 5.33 },
                    { id: '2000', name: 'ğŸ‘¥TikTok Xarici TakipÃ§i Yeni ucuz', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '4 saat', min: 10, max: 10000000, pricePerK: 1.99 },
                    { id: 'tiktok_foreign_follower_no_guarantee', name: 'ğŸ‘¥TikTok Xarici TakipÃ§i (Qaranti yoxdur)', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '300 saat', min: 10, max: 10000000, pricePerK: 4.93 },
                    { id: 'tiktok_quality_follower_no_guarantee', name: 'ğŸ‘¥TikTok Keyfiyyitli TakipÃ§i (Qaranti yoxdur)', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '65-120 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 6.54 },
                    { id: 'tiktok_quality_follower_60_day_guarantee', name: 'ğŸ‘¥TikTok Keyfiyyitli TakipÃ§i (60 gÃ¼n qaranti)', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '100-150 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 6.99 },
                ]
            },
            {
                platform: 'TikTok',
                category: 'â¤ï¸TikTok BÉ™yÉ™ni ServislÉ™ri',
                categoryIcon: '<i class="fab fa-tiktok text-white mr-2"></i>',
                items: [
                    { id: 'tiktok_video_like', name: '4014 - TikTok BÉ™yÉ™ni Min:30  â¤ï¸ |10M | BEST Min:10', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '9 dÉ™qiqÉ™', min: 30, max: 10000000, pricePerK: 1.51 },
                    { id: '00005', name: '4020 - TikTok BÉ™yÉ™ni Min:100  â¤ï¸ "Ã–zÉ™l"', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '20 dÉ™qiqÉ™', min: 100, max: 10000000, pricePerK: 0.71 },
                    { id: '00006', name: '4021 - TikTok BÉ™yÉ™ni Min:90.000 â¤ï¸ "Ã–zÉ™l-2"', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '28 dÉ™qiqÉ™', min: 90000, max: 10000000, pricePerK: 0.12 },
                    { id: '00001', name: '4015 -  NEW TikTok BÉ™yÉ™ni Min:30  â¤ï¸ |10M | BEST Min:30', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '25 dÉ™qiqÉ™', min: 30, max: 10000000, pricePerK: 2.38 },
                    { id: '00002', name: '4017 -  TikTok BÉ™yÉ™ni Min:150  â¤ï¸ Min:150', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '55 dÉ™qiqÉ™', min: 150, max: 10000000, pricePerK: 0.96 },
                    { id: '00003', name: '4018 -  TikTok BÉ™yÉ™ni Min:1.000  â¤ï¸ -Orta sÃ¼rÉ™t- Min:1000', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '59 dÉ™qiqÉ™', min: 1000, max: 10000000, pricePerK: 0.88 },
                    { id: '00004', name: '4019 -  TikTok BÉ™yÉ™ni Min:200  â¤ï¸ â­SÃ¼rÉ™tliâ­ Min:200', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '27 dÉ™qiqÉ™', min: 200, max: 10000000, pricePerK: 1.09 },
                ]
            },
            {
                platform: 'TikTok',
                category: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Ä°zlÉ™nmÉ™ ServislÉ™ri',
                categoryIcon: '<i class="fab fa-tiktok text-white mr-2"></i>',
                items: [
                    { id: 'tiktok_video_view', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Video Ä°zlÉ™nmÉ™ Min:100', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '1 saat', min: 100, max: 100000000, pricePerK: 0.14 },
                    { id: '000013', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Video Ä°zlÉ™nmÉ™ â­sÃ¼rÉ™tliâ­ Min:1.000.000', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '18 dÉ™qiqÉ™', min: 1000000, max: 100000000, pricePerK: 0.006 },
                    { id: '000010', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Video Ä°zlÉ™nmÉ™â­ultra sÃ¼rÉ™tliâ­ Min:100.000', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '12 dÉ™qiqÉ™', min: 100000, max: 100000000, pricePerK: 0.03 },
                    { id: '000011', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Video Ä°zlÉ™nmÉ™ â­sÃ¼rÉ™tliâ­ Min:1.000', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '6 dÉ™qiqÉ™', min: 1000, max: 100000000, pricePerK: 0.19 },
                    { id: '000012', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸TikTok Video Ä°zlÉ™nmÉ™ Min:10.000', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '28 dÉ™qiqÉ™', min: 10000, max: 100000000, pricePerK: 0.09 },
                ]
            },
            {
                platform: 'TikTok',
                category: 'ğŸ“ˆTikTok PaylaÅŸÄ±m,KaydetmÉ™,Yorum,Profil ServislÉ™ri',
                categoryIcon: '<i class="fab fa-tiktok text-white mr-2"></i>',
                items: [
                    { id: 'tiktok_video_share', name: 'ğŸš€TikTok Video PaylaÅŸma', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '10-60 dÉ™qiqÉ™', min: 10, max: 1000000, pricePerK: 4.02 },
                    { id: 'tiktok_video_save', name: 'ğŸ“ŒTikTok Video KaydetmÉ™', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '10-70 dÉ™qiqÉ™', min: 10, max: 1000000, pricePerK: 4.62 },
                    { id: 'tiktok_video_comment', name: 'ğŸ’¬TikTok Video Yorum', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '24-48 saat', min: 1, max: 1000, pricePerK: 12.00 },
                    { id: 'tiktok_profile_view', name: 'TikTok Profil GÃ¶rÃ¼ntÃ¼lÉ™mÉ™', icon: '<i class="fab fa-tiktok text-white"></i>', avgTime: '5-15 dÉ™qiqÉ™', min: 100, max: 50000000, pricePerK: 0.16 },
                ]
            },
            // Instagram Servisleri
            {
                platform: 'Instagram',  
                category: 'ğŸ‘¥Instagram TakipÃ§i Servisleri',
                categoryIcon: '<i class="fab fa-instagram text-purple-400 mr-2"></i>',
                items: [
                    { id: 'instagram_follower', name: 'ğŸ‘¥Instagram TakipÃ§iâŒiÅŸlÉ™mirâŒ', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '20-40 dÉ™qiqÉ™', min: 10, max: 1000000, pricePerK: 2.85 },
                    { id: 'instagram_az_follower', name: 'ğŸ‘¥Instagram AzÉ™rbaycanlÄ± TakipÃ§i ğŸ‡¦ğŸ‡¿', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '2 saat 30 dÉ™qiqÉ™', min: 10, max: 100000, pricePerK: 9.93 },
                    { id: 'instagram_tr_follower', name: 'ğŸ‘¥Instagram TÃ¼rk TakipÃ§i ï¿½ğŸ‡·', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '50 dÉ™qiqÉ™', min: 10, max: 500000, pricePerK: 9.30 },
                    { id: 'instagram_30day_guarantee', name: 'ğŸ‘¥Instagram 30 GÃ¼n Garantili TakipÃ§i <i class="fas fa-redo-alt text-blue-400"></i>', icon: '<i class="fab fa-instagram"></i>', avgTime: '1 saat', min: 10, max: 50000, pricePerK: 4.49 },
                    { id: 'instagram_100day_guarantee', name: 'ğŸ‘¥Instagram 100 GÃ¼n Garantili TakipÃ§i <i class="fas fa-redo-alt text-blue-400"></i>', icon: '<i class="fab fa-instagram"></i>', avgTime: '1 saat 10 dÉ™qiqÉ™', min: 10, max: 50000, pricePerK: 4.48 },
                    { id: 'instagram_365day_guarantee', name: 'ğŸ‘¥Instagram 365 GÃ¼n Garantili TakipÃ§i <i class="fas fa-redo-alt text-blue-400"></i>', icon: '<i class="fab fa-instagram"></i>', avgTime: '25 dÉ™qiqÉ™', min: 10, max: 50000, pricePerK: 5.79 },
                    { id: 'instagram_lifetime_guarantee', name: 'ğŸ‘¥Instagram Ã–mÃ¼r Boyu Garantili TakipÃ§i <i class="fas fa-infinity text-blue-400"></i>', icon: '<i class="fab fa-instagram"></i>', avgTime: '1 saat 40 dÉ™qiqÉ™', min: 10, max: 20000, pricePerK: 6 },
                ]
            },
            {
                platform: 'Instagram',  
                category: 'â¤ï¸Instagram BÉ™yÉ™ni ServislÉ™ri',
                categoryIcon: '<i class="fab fa-instagram text-purple-400 mr-2"></i>',
                items: [
                    { id: 'instagram_like', name: 'â¤ï¸Instagram BÉ™yÉ™ni (heÃ§vaxd enmÉ™z)', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '0-5 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 0.79 },
                    { id: '1001', name: 'â¤ï¸01 - Instagram BÉ™yÉ™ni (heÃ§vaxd enmÉ™z)', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '32 dÉ™qiqÉ™', min: 30000, max: 10000000, pricePerK: 0.28 },
                    { id: 'instagram_like_no_guarantee', name: 'â¤ï¸Instagram BÉ™yÉ™ni (Qaranti yoxdur)', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '0-5 dÉ™qiqÉ™', min: 10, max: 10000000, pricePerK: 0.69 },
                    { id: 'instagram_az_like', name: 'â¤ï¸Instagram AzÉ™rbaycanlÄ± BÉ™yÉ™ni ğŸ‡¦ğŸ‡¿', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '5-15 dÉ™qiqÉ™', min: 10, max: 100000, pricePerK: 2.08 },
                ]
            },
            {
                platform: 'Instagram',  
                category: 'ğŸ‘ï¸â€ğŸ—¨ï¸Instagram Ä°zlÉ™nmÉ™ ServislÉ™ri',
                categoryIcon: '<i class="fab fa-instagram text-purple-400 mr-2"></i>',
                items: [
                    { id: 'instagram_video_view', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸Instagram Video Ä°zlÉ™nmÉ™', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '3 saat', min: 100, max: 50000000, pricePerK: 0.12 },
                    { id: '10000', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸Instagram Video Ä°zlÉ™nmÉ™ â­SÃ¼rÉ™tliâ­', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '38 dÉ™qiqÉ™', min: 100, max: 50000000, pricePerK: 0.21 },
                    { id: 'instagram_az_video_view', name: 'ğŸ‘ï¸â€ğŸ—¨ï¸Instagram AzÉ™rbaycanlÄ± Video Ä°zlÉ™nmÉ™ ğŸ‡¦ğŸ‡¿', icon: '<i class="fab fa-instagram"></i>', avgTime: '10-30 dÉ™qiqÉ™', min: 100, max: 5000000, pricePerK: 0.99 },
                ]
            },
            {
                platform: 'Instagram',  
                category: 'ğŸ“ˆInstagram Yorum,PaylaÅŸÄ±m,KaydetmÉ™ ServislÉ™ri',
                categoryIcon: '<i class="fab fa-instagram text-purple-400 mr-2"></i>',
                items: [
                    { id: 'instagram_comment', name: 'ğŸ’¬Instagram Yorum', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '24-48 saat', min: 1, max: 500, pricePerK: 9.00 },
                    { id: 'instagram_save', name: 'ğŸ“ŒInstagram KaydetmÉ™', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '5-15 dÉ™qiqÉ™', min: 10, max: 1000000, pricePerK: 3.26 },
                    { id: 'instagram_share', name: 'ğŸš€Instagram PaylaÅŸma', icon: '<i class="fab fa-instagram text-purple-400"></i>', avgTime: '5-15 dÉ™qiqÉ™', min: 10, max: 1000000, pricePerK: 5.09 },
                ]
            },
        ];

        let currentUserId = null;
        let userBalance = 0;
        let selectedCategory = null; // SeÃ§ili kategori objesi
        let selectedService = null; // SeÃ§ili servis objesi

        // DOM ElementlÉ™ri
        const userBalanceEl = document.getElementById('user-balance');
        const userIdDisplayEl = document.getElementById('user-id-display'); // KullanÄ±cÄ± ID'sini gÃ¶sterecek element
        const topUpButton = document.getElementById('top-up-button');
        const categorySelect = document.getElementById('category-select');
        const serviceSelect = document.getElementById('service-select');
        const linkInput = document.getElementById('link-input');
        const quantityInput = document.getElementById('quantity-input');
        const minQuantityEl = document.getElementById('min-quantity');
        const maxQuantityEl = document.getElementById('max-quantity');
        const avgTimeInput = document.getElementById('avg-time-input');
        const priceInput = document.getElementById('price-input');
        const placeOrderButton = document.getElementById('place-order-button');
        const alertContainer = document.getElementById('alert-container');
        const topUpModal = document.getElementById('top-up-modal');
        const closeTopUpModalButton = document.getElementById('close-top-up-modal');
        const bottomNavTopUp = document.getElementById('bottom-nav-topup'); // Alt navigasyondaki Balans É™lavÉ™ et butonu
        const headerCampaignsButton = document.getElementById('header-campaigns-button'); // BaÅŸlÄ±qdakÄ± Kampaniyalar butonu
        const floatingWhatsappBubble = document.getElementById('floating-whatsapp-bubble'); // Yeni WhatsApp balonu
        const whatsappTopUpLink = document.getElementById('whatsapp-topup-link'); // WhatsApp linki (modal iÃ§inde)
        const bankCardNumberEl = document.getElementById('bank-card-number'); // Bank kartÄ± nÃ¶mrÉ™si elementi
        const campaignsSection = document.getElementById('campaigns-section'); // Kampaniyalar bÃ¶lmÉ™sinin ID-si
        // `totalUsersCountEl` elementi silindi

        // AÃ§Ä±qlama bÃ¶lmÉ™sindeki DOM elementlÉ™ri
        const descMinQuantity = document.getElementById('desc-min-quantity');
        const descMaxQuantity = document.getElementById('desc-max-quantity');
        const descAvgTime = document.getElementById('desc-avg-time');

        // Ã–dÉ™niÅŸ mÉ™lumatlarÄ±
        const PAYMENT_CARD_NUMBER = "4169 7388 7208 5778";
        const PAYMENT_WHATSAPP_NUMBER = "994606006162"; // WhatsApp API iÃ§in baÅŸÄ±nda 994 olmalÄ±

        // RÉ™qÉ™mlÉ™ri 3 sÄ±fÄ±rdan bir nÃ¶qtÉ™ ilÉ™ formatlaÅŸdÄ±ran funksiya
        function formatNumberWithDots(number) {
            if (number === null || number === undefined || isNaN(number)) {
                return '';
            }
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // BalansÄ± yenilÉ™mÉ™ funksiyasÄ± (4 onluq rÉ™qÉ™mlÉ™ yuvarlaqlaÅŸdÄ±rÄ±ldÄ±)
        async function updateBalanceUI() {
            if (currentUserId) {
                const userDocRef = doc(db, `users`, currentUserId);
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists() && userDocSnap.data().balance !== undefined) {
                    userBalance = userDocSnap.data().balance;
                } else {
                    userBalance = 0;
                    await setDoc(userDocRef, { balance: 0 }, { merge: true }); // Merge true, diÄŸer verileri korur
                }
                userBalanceEl.textContent = `${userBalance.toFixed(4)} AZN`; // 4 onluq rÉ™qÉ™m
            }
        }

        // Custom Alert FunksiyasÄ±
        function showAlert(message, type = 'error', duration = 3000) {
            const alertBox = document.createElement('div');
            alertBox.className = `alert-message ${type}`;
            alertBox.innerHTML = message;
            
            const existingAlerts = document.querySelectorAll('.alert-message');
            existingAlerts.forEach(alert => alert.remove());

            if (type === 'success') {
                alertBox.classList.remove('bg-red-600');
                alertBox.classList.add('bg-green-600');
            } else {
                alertBox.classList.remove('bg-green-600');
                alertBox.classList.add('bg-red-600');
            }
            alertContainer.appendChild(alertBox);
            setTimeout(() => {
                alertBox.classList.add('show');
            }, 10);
            setTimeout(() => {
                alertBox.classList.remove('show');
                alertBox.addEventListener('transitionend', () => alertBox.remove(), { once: true });
            }, duration);
        }

        // Real-time istifadÉ™Ã§i sayÄ± dinlÉ™yicisi funksiyasÄ± silindi

        // Firebase Autentifikasiya vÉ™ Balans YÃ¼klÉ™nmÉ™si
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserId = user.uid;
                userIdDisplayEl.textContent = currentUserId; // Ä°stifadÉ™Ã§i ID'sini gÃ¶stÉ™r
                await updateBalanceUI();
                // `setupUserCountListener()` Ã§aÄŸÄ±rÄ±ÅŸÄ± silindi
            } else {
                signInAnonymously(auth).then(async (anonUserCredential) => {
                    currentUserId = anonUserCredential.user.uid;
                    userIdDisplayEl.textContent = currentUserId; // Ä°stifadÉ™Ã§i ID'sini gÃ¶stÉ™r
                    await updateBalanceUI();
                    // `setupUserCountListener()` Ã§aÄŸÄ±rÄ±ÅŸÄ± silindi
                }).catch(error => {
                    console.error("Anonim giriÅŸdÉ™ xÉ™ta:", error);
                    showAlert("SistemÉ™ daxil olarkÉ™n xÉ™ta baÅŸ verdi. ZÉ™hmÉ™t olmasa sÉ™hifÉ™ni yenilÉ™yin.", 'error');
                });
            }
        });

        // Kategori select'ini doldur
        function populateCategorySelect() {
            categorySelect.innerHTML = '<option value="">Kateqoriya SeÃ§in</option>';
            // Sadece benzersiz kategorileri al
            const uniqueCategories = [...new Set(allServices.map(s => s.category))];
            uniqueCategories.forEach(categoryName => {
                const categoryData = allServices.find(s => s.category === categoryName);
                const option = document.createElement('option');
                option.value = categoryData.category;
                option.innerHTML = `${categoryData.categoryIcon || ''} ${categoryData.category}`;
                categorySelect.appendChild(option);
            });
        }

        // Kategori seÃ§ildiÄŸinde servis select'ini doldur
        categorySelect.addEventListener('change', () => {
            const selectedCategoryName = categorySelect.value;
            selectedCategory = allServices.find(cat => cat.category === selectedCategoryName) || null;
            
            serviceSelect.innerHTML = '<option value="">Servis SeÃ§in</option>';
            serviceSelect.disabled = true;
            selectedService = null;
            resetOrderForm(); // Kategori deÄŸiÅŸtiÄŸinde formu sÄ±fÄ±rla
            updateDescriptionBox(); // Kategori deÄŸiÅŸtiÄŸinde aÃ§Ä±klama kutusunu gÃ¼ncelle

            if (selectedCategory) {
                // Servisleri fiyata gÃ¶re sÄ±rala (burada pricePerK en dÃ¼ÅŸÃ¼kten en yÃ¼kseÄŸe doÄŸru sÄ±ralanacak)
                const sortedServices = [...selectedCategory.items].sort((a, b) => a.pricePerK - b.pricePerK);

                sortedServices.forEach(service => {
                    const option = document.createElement('option');
                    option.value = service.id;
                    const priceText = `${service.pricePerK.toFixed(4)} AZN`; // 4 onluq rÉ™qÉ™m
                    option.innerHTML = `${service.icon} ${service.name} (1K - ${priceText})`; // Fiyat bilgisi eklendi
                    serviceSelect.appendChild(option);
                });
                serviceSelect.disabled = false;
            }
        });

        // Servis seÃ§ildiÄŸinde fiyat ve min/max deÄŸerlerini gÃ¶ster
        serviceSelect.addEventListener('change', async () => {
            const selectedServiceId = serviceSelect.value;
            selectedService = selectedCategory ? { 
                ...selectedCategory.items.find(item => item.id === selectedServiceId),
                platform: selectedCategory.platform 
            } : null;

            resetOrderForm(); // Servis deÄŸiÅŸtiÄŸinde formu sÄ±fÄ±rla

            if (selectedService) {
                quantityInput.disabled = false;
                linkInput.disabled = false;
                minQuantityEl.textContent = formatNumberWithDots(selectedService.min);
                maxQuantityEl.textContent = formatNumberWithDots(selectedService.max);
                quantityInput.min = selectedService.min;
                quantityInput.max = selectedService.max;
                avgTimeInput.value = selectedService.avgTime;
                
                calculateOrderPrice(); // Servis deÄŸiÅŸtiÄŸinde fiyatÄ± yeniden hesapla
                updateDescriptionBox(); // Servis deÄŸiÅŸtiÄŸinde aÃ§Ä±klama kutusunu gÃ¼ncelle
            } else {
                updateDescriptionBox(); // Servis seÃ§imi kaldÄ±rÄ±ldÄ±ÄŸÄ±nda sÄ±fÄ±rla
            }
        });

        // Miktar girildiÄŸinde fiyatÄ± hesapla ve formatla
        quantityInput.addEventListener('input', () => {
            const rawValue = quantityInput.value.replace(/\D/g, ''); // Sadece rÉ™qÉ™mlÉ™ri al
            quantityInput.value = formatNumberWithDots(rawValue); // FormatlaÅŸdÄ±rÄ±lmÄ±ÅŸ dÉ™yÉ™ri gÃ¶stÉ™r
            calculateOrderPrice();
        });

        function calculateOrderPrice() {
            if (!selectedService) {
                priceInput.value = '';
                placeOrderButton.disabled = true;
                return;
            }

            // FormatlanmÄ±ÅŸ rÉ™qÉ™mdÉ™n nÃ¶qtÉ™lÉ™ri silÉ™rÉ™k tam rÉ™qÉ™m alÄ±rÄ±q
            const quantity = parseInt(quantityInput.value.replace(/\./g, ''));

            if (isNaN(quantity)) {
                priceInput.value = '';
                placeOrderButton.disabled = true;
                return;
            }

            // Miktar minimum ve maksimum aralÄ±ÄŸÄ±nda mÄ± kontrol et
            if (quantity < selectedService.min || quantity > selectedService.max) {
                priceInput.value = '';
                placeOrderButton.disabled = true;
                if (quantity > 0) { // Sadece pozitif miktarlar iÃ§in hata gÃ¶ster
                    showAlert(`Miqdar ${formatNumberWithDots(selectedService.min)} ilÉ™ ${formatNumberWithDots(selectedService.max)} arasÄ±nda olmalÄ±dÄ±r.`, 'error', 4000);
                }
                return;
            }

            const price = (quantity / 1000) * selectedService.pricePerK;
            priceInput.value = `${price.toFixed(4)} AZN`; // 4 onluq rÉ™qÉ™m
            placeOrderButton.disabled = false;
        }

        // SipariÅŸ formunu sÄ±fÄ±rla
        function resetOrderForm() {
            linkInput.value = '';
            quantityInput.value = '';
            quantityInput.disabled = false; // ResetlÉ™yÉ™ndÉ™ aktiv olsun
            avgTimeInput.value = '';
            priceInput.value = '';
            minQuantityEl.textContent = '0';
            maxQuantityEl.textContent = '0';
            placeOrderButton.disabled = true;
        }

        // AÃ§Ä±qlama qutusunu yenilÉ™
        function updateDescriptionBox() {
            if (selectedService) {
                descMinQuantity.textContent = formatNumberWithDots(selectedService.min);
                descMaxQuantity.textContent = formatNumberWithDots(selectedService.max);
                descAvgTime.textContent = selectedService.avgTime;
            } else {
                descMinQuantity.textContent = 'N/A';
                descMaxQuantity.textContent = 'N/A';
                descAvgTime.textContent = 'N/A';
            }
        }

        // Balans artÄ±rma modalÄ±nÄ± aÃ§ (Balans ArtÄ±r dÃ¼ymÉ™si)
        topUpButton.addEventListener('click', () => {
            if (!currentUserId) {
                showAlert("Balans artÄ±rmaq Ã¼Ã§Ã¼n sistemÉ™ daxil olmalÄ±sÄ±nÄ±z. ZÉ™hmÉ™t olmasa sÉ™hifÉ™ni yenilÉ™yin.", 'error');
                return;
            }
            topUpModal.classList.add('show'); // 'show' sÄ±nÄ±fÄ±nÄ± ekleyerek gÃ¶rÃ¼nÃ¼r yap
            // WhatsApp linkini dinamik olarak gÃ¼ncelle
            whatsappTopUpLink.href = `https://wa.me/${PAYMENT_WHATSAPP_NUMBER}?text=${encodeURIComponent('Salam, mÉ™nim istifadÉ™Ã§i ID-m: ' + currentUserId + '. Balans artÄ±rmaq istÉ™yirÉ™m.')}`;
            bankCardNumberEl.textContent = PAYMENT_CARD_NUMBER; // Kart numarasÄ±nÄ± ayarla
        });

        // Alt navigasyondaki "Balans É™lavÉ™ et" butonu
        bottomNavTopUp.addEventListener('click', (e) => {
            e.preventDefault(); // VarsayÄ±lan link davranÄ±ÅŸÄ±nÄ± engelle
            topUpButton.click(); // Ãœstteki butonu tÄ±kla
        });

        // Balans artÄ±rma modalÄ±nÄ± kapat (X dÃ¼ymÉ™si)
        if (closeTopUpModalButton) {
            closeTopUpModalButton.addEventListener('click', () => {
                topUpModal.classList.remove('show'); // 'show' sÄ±nÄ±fÄ±nÄ± kaldÄ±rarak gizlÉ™
            });
        }

        // Modala dÄ±ÅŸ tÄ±klama ile kapatma
        if (topUpModal) {
            topUpModal.addEventListener('click', (event) => {
                // Sadece modalÄ±n arka planÄ±na tÄ±klandÄ±ÄŸÄ±nda kapanmasÄ± iÃ§in kontrol et
                if (event.target === topUpModal) {
                    topUpModal.classList.remove('show'); // 'show' sÄ±nÄ±fÄ±nÄ± kaldÄ±rarak gizlÉ™
                }
            });
        }

        // Floating WhatsApp Bubble'Ä± baÅŸlat
        if (floatingWhatsappBubble) {
            floatingWhatsappBubble.addEventListener('click', (e) => {
                e.preventDefault();
                const whatsappMessage = `Salam, dÉ™stÉ™yÉ™ ehtiyacÄ±m var. Ä°stifadÉ™Ã§i ID-m: ${currentUserId}.`;
                const whatsappUrl = `https://wa.me/${PAYMENT_WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMessage)}`;
                window.open(whatsappUrl, '_blank');
            });
        }

        // BaÅŸlÄ±qdakÄ± Kampaniyalar dÃ¼ymÉ™sinÉ™ kliklÉ™mÉ™ hadisÉ™si
        if (headerCampaignsButton) {
            headerCampaignsButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (campaignsSection) {
                    campaignsSection.scrollIntoView({ behavior: 'smooth' });
                }
            });
        }

        // SipariÅŸ oluÅŸtur
        placeOrderButton.addEventListener('click', async () => {
            if (!currentUserId) {
                showAlert("SifariÅŸ vermÉ™k Ã¼Ã§Ã¼n sistemÉ™ daxil olmalÄ±sÄ±nÄ±z.", 'error');
                return;
            }
            if (!selectedService || !linkInput.value.trim() || !quantityInput.value.trim()) {
                showAlert("ZÉ™hmÉ™t olmasa, bÃ¼tÃ¼n sifariÅŸ detallarÄ±nÄ± doldurun.", 'error');
                return;
            }

            // FormatlanmÄ±ÅŸ miqdarÄ± rÉ™qÉ™mÉ™ Ã§evir
            const quantity = parseInt(quantityInput.value.replace(/\./g, ''));
            const priceText = priceInput.value;
            const totalPrice = parseFloat(priceText.replace(' AZN', ''));
            
            // Ã–dÉ™niÅŸli servislÉ™r Ã¼Ã§Ã¼n yoxlamalar
            if (userBalance < totalPrice) {
                showAlert("BalansÄ±nÄ±z yetÉ™rli deyil. ZÉ™hmÉ™t olmasa balansÄ±nÄ±zÄ± artÄ±rÄ±n.", 'error');
                return;
            }
            if (isNaN(quantity) || quantity < selectedService.min || quantity > selectedService.max) {
                showAlert(`Miqdar ${formatNumberWithDots(selectedService.min)} ilÉ™ ${formatNumberWithDots(selectedService.max)} arasÄ±nda olmalÄ±dÄ±r.`, 'error');
                return;
            }

            try {
                const orderData = {
                    userId: currentUserId,
                    serviceId: selectedService.id,
                    serviceName: selectedService.name,
                    platform: selectedService.platform,
                    link: linkInput.value.trim(),
                    quantity: quantity,
                    totalPrice: totalPrice,
                    avgTime: selectedService.avgTime,
                    timestamp: serverTimestamp(),
                    status: 'pending',
                    isNew: true,
                };
                
                // HÉ™miÅŸÉ™ 'orders' kolleksiyasÄ±na yazÄ±lÄ±r
                const orderCollectionRef = collection(db, `artifacts/${firebaseProjectId}/public/data/orders`);
                const userDocRef = doc(db, `users`, currentUserId);
                
                // BalansÄ± yenilÉ™ (4 onluq rÉ™qÉ™mlÉ™)
                await updateDoc(userDocRef, {
                    balance: parseFloat((userBalance - totalPrice).toFixed(4)) // BalansÄ± yuvarlaqlaÅŸdÄ±rÄ±b yenilÉ™
                });
                userBalance = parseFloat((userBalance - totalPrice).toFixed(4)); // Cari balansÄ± da yenilÉ™
                userBalanceEl.textContent = `${userBalance.toFixed(4)} AZN`; // UI-da da 4 onluq rÉ™qÉ™m gÃ¶stÉ™r
                
                const newOrderRef = await addDoc(orderCollectionRef, orderData);

                showAlert(`SifariÅŸiniz yerlÉ™ÅŸdirildi! SifariÅŸ ID-si: ${newOrderRef.id}. ZÉ™hmÉ™t olmasa, adminÉ™ WhatsAppdan bu ID-ni gÃ¶ndÉ™rin: ${newOrderRef.id}`, 'success', 10000);
                
                resetOrderForm(); // Formu sÄ±fÄ±rla
                categorySelect.value = ""; // KateqoriyanÄ± sÄ±fÄ±rla
                serviceSelect.innerHTML = '<option value="">Servis SeÃ§in</option>'; // Servis seÃ§imi boÅŸalsÄ±n
                serviceSelect.disabled = true; // Servis seÃ§imi deaktiv olsun
                selectedCategory = null;
                selectedService = null;
                updateDescriptionBox(); // AÃ§Ä±qlama qutusunu sÄ±fÄ±rla/gÃ¼ncÉ™llÉ™

                // SifariÅŸ tamamlandÄ±qdan sonra orders.html sÉ™hifÉ™sinÉ™ yÃ¶nlÉ™ndir
                setTimeout(() => {
                    window.location.href = 'orders.html';
                }, 1000);

            } catch (error) {
                console.error("SifariÅŸ yerlÉ™ÅŸdirmÉ™ xÉ™tasÄ±:", error);
                showAlert("SifariÅŸ yerlÉ™ÅŸdirÉ™rkÉ™n gÃ¶zlÉ™nilmÉ™z xÉ™ta baÅŸ verdi. ZÉ™hmÉ™t olmasa yenidÉ™n cÉ™hd edin.", 'error');
            }
        });

        // Sayfa yÃ¼klendiÄŸinde servis kategorilerini ve UI'yi baÅŸlat
        window.onload = () => {
            populateCategorySelect();
            updateDescriptionBox(); // BaÅŸlangÄ±Ã§ta aÃ§Ä±klama kutusunu sÄ±fÄ±rla
        };
    </script>
</body>
</html>
ï¿½
