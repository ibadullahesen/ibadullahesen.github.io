<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AxtarGet - Professional Image Editor. Powerful photo editing tools: filters, background removal, adjustments, and more. Free online image editor like Photoshop.">
    <meta name="keywords" content="image editor, photo editor, background remover, filters, online editor, AxtarGet, professional editing, şəkil redaktoru, foto redaktoru, online redaktor, pulsuz şəkil redaktoru">
    <meta name="author" content="AxtarGet">
    <meta property="og:title" content="AxtarGet - Professional Image Editor">
    <meta property="og:description" content="Powerful image editing tools - Background removal, filters, tone adjustments, and professional effects">
    <meta property="og:image" content="https://axtarget.xyz/og-image.jpg">
    <meta name="theme-color" content="#0F172A">
    <title>AxtarGet - Professional Image Editor | Free Online Photo Editing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0F172A;
            --bg-card: #1E293B;
            --bg-panel: #334155;
            --bg-hover: #475569;
            --border-color: #1E293B;
            --text-primary: #F1F5F9;
            --text-secondary: #CBD5E1;
            --accent-primary: #3B82F6;
            --accent-hover: #2563EB;
            --accent-active: #1D4ED8;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --purple: #8B5CF6;
            --pink: #EC4899;
            --orange: #F97316;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.5;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }

        /* HEADER */
        header {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .header-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .file-name {
            color: var(--text-secondary);
            font-size: 0.875rem;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* MAIN EDITOR AREA */
        .editor-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 1px;
            background-color: var(--border-color);
        }

        /* LEFT TOOLBAR */
        .toolbar-left {
            width: 70px;
            background-color: var(--bg-card);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem 0;
            gap: 0.5rem;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
        }

        .tool-btn {
            width: 50px;
            height: 50px;
            border-radius: 0.5rem;
            background-color: transparent;
            color: var(--text-secondary);
            border: 2px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.2s ease;
            position: relative;
        }

        .tool-btn:hover {
            background-color: var(--bg-panel);
            color: var(--text-primary);
        }

        .tool-btn.active {
            background-color: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .tool-btn svg {
            width: 24px;
            height: 24px;
        }

        /* CENTER CANVAS */
        .canvas-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-dark);
            position: relative;
            overflow: hidden;
        }

        .canvas-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #1E293B 25%, transparent 25%, transparent 75%, #1E293B 75%, #1E293B),
                        linear-gradient(45deg, #1E293B 25%, transparent 25%, transparent 75%, #1E293B 75%, #1E293B);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            background-color: var(--bg-dark);
            position: relative;
            overflow: hidden;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: crosshair;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .upload-zone {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px dashed var(--accent-primary);
            border-radius: 0.5rem;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 10;
        }

        .upload-zone.active {
            opacity: 1;
            pointer-events: all;
        }

        /* RIGHT PANEL */
        .panel-right {
            width: 320px;
            background-color: var(--bg-card);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }

        .panel-section {
            margin-bottom: 1.5rem;
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title i {
            font-size: 1rem;
        }

        /* SLIDERS */
        .slider-group {
            margin-bottom: 1.25rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .slider-label-value {
            color: var(--accent-primary);
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: var(--bg-panel);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            border: none;
            transition: background 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: var(--accent-hover);
        }

        /* BUTTONS */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .btn-primary {
            background-color: var(--accent-primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: var(--accent-hover);
        }

        .btn-primary:active {
            background-color: var(--accent-active);
        }

        .btn-secondary {
            background-color: var(--bg-panel);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: var(--bg-hover);
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            width: 100%;
        }

        .btn-group .btn {
            flex: 1;
        }

        .btn.active {
            background-color: var(--accent-primary);
            color: white;
        }

        /* FILTER SELECTOR */
        .filter-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .filter-option {
            background-color: var(--bg-panel);
            border: 2px solid transparent;
            color: var(--text-secondary);
            padding: 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .filter-option:hover {
            background-color: var(--bg-hover);
            color: var(--text-primary);
        }

        .filter-option.active {
            background-color: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .filter-name {
            font-weight: 600;
        }

        .filter-desc {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* HIDDEN ELEMENTS */
        input[type="file"] {
            display: none;
        }

        .hidden {
            display: none !important;
        }

        /* TOAST NOTIFICATION */
        .toast {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: var(--bg-card);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--success);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 200;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* TEXT TOOL MODAL */
        .text-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .text-modal-content {
            background-color: var(--bg-card);
            border-radius: 0.5rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .text-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .text-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .text-modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
        }

        .text-modal-close:hover {
            background-color: var(--bg-hover);
        }

        .text-input-group {
            margin-bottom: 1rem;
        }

        .text-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .text-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-panel);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .text-preview {
            background-color: var(--bg-panel);
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
        }

        /* BRUSH TOOLS */
        .brush-tools {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .brush-color-picker {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brush-color-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background-color: #000000;
        }

        .brush-presets {
            display: flex;
            gap: 0.5rem;
        }

        .brush-preset {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .brush-preset.active {
            border-color: var(--accent-primary);
            transform: scale(1.1);
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .panel-right {
                width: 280px;
            }
            
            .filter-selector {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .panel-right {
                display: none;
            }

            .toolbar-left {
                width: 60px;
            }

            .tool-btn {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .mobile-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: var(--bg-card);
                padding: 1rem;
                border-top: 1px solid var(--border-color);
                z-index: 100;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <header>
            <div class="header-brand">
                <i class="fas fa-camera-retro"></i>
                AxtarGet
            </div>
            <div class="file-name" id="fileName">Şəkil seçin</div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" id="resetBtn" disabled>
                    <i class="fas fa-redo"></i> Sıfırla
                </button>
                <button class="btn btn-primary btn-small" id="downloadBtn" disabled>
                    <i class="fas fa-download"></i> Endir
                </button>
            </div>
        </header>

        <!-- MAIN EDITOR -->
        <div class="editor-container">
            <!-- LEFT TOOLBAR -->
            <div class="toolbar-left">
                <button class="tool-btn active" id="toolSelect" title="Seçim">
                    <i class="fas fa-mouse-pointer"></i>
                </button>
                <button class="tool-btn" id="toolFilters" title="Filtrlər">
                    <i class="fas fa-sliders-h"></i>
                </button>
                <button class="tool-btn" id="toolAdjust" title="Düzəlişlər">
                    <i class="fas fa-adjust"></i>
                </button>
                <button class="tool-btn" id="toolBrush" title="Fırça">
                    <i class="fas fa-paint-brush"></i>
                </button>
                <button class="tool-btn" id="toolRemove" title="Fon Silmə">
                    <i class="fas fa-eraser"></i>
                </button>
                <button class="tool-btn" id="toolText" title="Mətn Əlavə Et">
                    <i class="fas fa-font"></i>
                </button>
            </div>

            <!-- CANVAS AREA -->
            <div class="canvas-wrapper">
                <div class="canvas-area" id="canvasArea">
                    <div class="upload-zone" id="uploadZone">
                        <div class="empty-state">
                            <div class="empty-state-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                            <div class="empty-state-text">Şəkili buraya sürüklə</div>
                        </div>
                    </div>
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon"><i class="fas fa-image"></i></div>
                        <div class="empty-state-text">Şəkil yükləmək üçün aşağı düyməni klikləyin</div>
                        <label for="fileInput" class="btn btn-primary" style="cursor: pointer;">
                            <i class="fas fa-upload"></i> Şəkil Yüklə
                        </label>
                    </div>
                    <canvas id="canvas" class="hidden"></canvas>
                </div>
            </div>

            <!-- RIGHT PANEL -->
            <div class="panel-right" id="controlPanel">
                <!-- FILTERS -->
                <div id="filtersSection">
                    <div class="panel-title">
                        <i class="fas fa-sliders-h"></i> Filtrlər
                    </div>
                    <div class="filter-selector" id="filterSelector">
                        <!-- 30 müasir filtr buraya əlavə ediləcək -->
                    </div>
                </div>

                <!-- ADJUSTMENTS -->
                <div id="adjustmentsSection" class="panel-section hidden">
                    <div class="panel-title">
                        <i class="fas fa-adjust"></i> Düzəlişlər
                    </div>
                    
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Parlaqlıq</span>
                            <span class="slider-label-value" id="brightnessValue">0</span>
                        </div>
                        <input type="range" id="brightness" min="-100" max="100" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Kontrast</span>
                            <span class="slider-label-value" id="contrastValue">0</span>
                        </div>
                        <input type="range" id="contrast" min="-100" max="100" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Doyğunluq</span>
                            <span class="slider-label-value" id="saturationValue">0</span>
                        </div>
                        <input type="range" id="saturation" min="-100" max="100" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Ton</span>
                            <span class="slider-label-value" id="hueValue">0</span>
                        </div>
                        <input type="range" id="hue" min="-180" max="180" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-label">
                            <span>Bulanıqlıq</span>
                            <span class="slider-label-value" id="blurValue">0</span>
                        </div>
                        <input type="range" id="blur" min="0" max="20" value="0">
                    </div>
                </div>

                <!-- BRUSH TOOLS -->
                <div id="brushSection" class="panel-section hidden">
                    <div class="panel-title">
                        <i class="fas fa-paint-brush"></i> Fırça Alətləri
                    </div>
                    
                    <div class="brush-tools">
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Fırça Ölçüsü</span>
                                <span class="slider-label-value" id="brushSizeValue">20</span>
                            </div>
                            <input type="range" id="brushSize" min="5" max="100" value="20">
                        </div>
                        
                        <div class="brush-color-picker">
                            <div class="brush-color-preview" id="brushColorPreview"></div>
                            <input type="color" id="brushColor" value="#000000" style="flex: 1; height: 40px; border: 1px solid var(--border-color); border-radius: 0.375rem; cursor: pointer;">
                        </div>
                        
                        <div class="brush-presets">
                            <div class="brush-preset active" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="brush-preset" style="background-color: #ffffff;" data-color="#ffffff"></div>
                            <div class="brush-preset" style="background-color: #ff0000;" data-color="#ff0000"></div>
                            <div class="brush-preset" style="background-color: #00ff00;" data-color="#00ff00"></div>
                            <div class="brush-preset" style="background-color: #0000ff;" data-color="#0000ff"></div>
                            <div class="brush-preset" style="background-color: #ffff00;" data-color="#ffff00"></div>
                        </div>
                        
                        <button class="btn btn-primary" id="clearBrushBtn">
                            <i class="fas fa-trash"></i> Təmizlə
                        </button>
                    </div>
                </div>

                <!-- BACKGROUND REMOVAL -->
                <div id="bgRemovalSection" class="panel-section hidden">
                    <div class="panel-title">
                        <i class="fas fa-eraser"></i> Fon Silmə
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary active" id="colorRemoveMode">Rəngə Görə</button>
                        <button class="btn btn-secondary" id="brushRemoveMode">Fırça</button>
                    </div>

                    <div id="colorPickerSection" class="panel-section">
                        <label style="color: var(--text-secondary); font-size: 0.875rem; display: block; margin-bottom: 0.5rem;">
                            Silinəcək Rəng:
                        </label>
                        <input type="color" id="colorToRemove" value="#00ff00" style="width: 100%; height: 40px; border: 1px solid var(--border-color); border-radius: 0.375rem; cursor: pointer;">
                        
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Tolerans</span>
                                <span class="slider-label-value" id="toleranceValue">30</span>
                            </div>
                            <input type="range" id="tolerance" min="0" max="100" value="30">
                        </div>

                        <button class="btn btn-primary" id="applyColorRemove">
                            <i class="fas fa-check"></i> Tətbiq Et
                        </button>
                    </div>

                    <div id="brushRemoveSection" class="panel-section hidden">
                        <div class="slider-group">
                            <div class="slider-label">
                                <span>Fırça Ölçüsü</span>
                                <span class="slider-label-value" id="brushRemoveSizeValue">20</span>
                            </div>
                            <input type="range" id="brushRemoveSize" min="5" max="100" value="20">
                        </div>
                        
                        <button class="btn btn-primary" id="applyBrushRemove">
                            <i class="fas fa-check"></i> Tətbiq Et
                        </button>
                    </div>
                </div>

                <!-- TEXT TOOL -->
                <div id="textSection" class="panel-section hidden">
                    <div class="panel-title">
                        <i class="fas fa-font"></i> Mətn Əlavə Et
                    </div>
                    <button class="btn btn-primary" id="addTextBtn">
                        <i class="fas fa-plus"></i> Mətn Əlavə Et
                    </button>
                </div>

                <!-- EXPORT OPTIONS -->
                <div class="panel-section">
                    <div class="panel-title">
                        <i class="fas fa-download"></i> Keyfiyyət
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary active" data-quality="1">Təmiz</button>
                        <button class="btn btn-secondary" data-quality="0.8">80%</button>
                        <button class="btn btn-secondary" data-quality="0.6">60%</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TEXT MODAL -->
    <div id="textModal" class="text-modal hidden">
        <div class="text-modal-content">
            <div class="text-modal-header">
                <div class="text-modal-title">Mətn Əlavə Et</div>
                <button class="text-modal-close" id="textModalClose">&times;</button>
            </div>
            <div class="text-input-group">
                <label for="textInput">Mətn:</label>
                <input type="text" id="textInput" class="text-input" placeholder="Mətninizi yazın...">
            </div>
            <div class="text-input-group">
                <label for="textColor">Rəng:</label>
                <input type="color" id="textColor" value="#ffffff" style="width: 100%; height: 40px; border: 1px solid var(--border-color); border-radius: 0.375rem; cursor: pointer;">
            </div>
            <div class="text-input-group">
                <label for="textSize">Ölçü:</label>
                <input type="range" id="textSize" min="12" max="72" value="24">
                <div class="slider-label">
                    <span></span>
                    <span class="slider-label-value" id="textSizeValue">24px</span>
                </div>
            </div>
            <div class="text-preview" id="textPreview">
                <span id="previewText" style="font-size: 24px; color: white;">Mətn Önizləmə</span>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" id="cancelTextBtn">Ləğv Et</button>
                <button class="btn btn-primary" id="applyTextBtn">Tətbiq Et</button>
            </div>
        </div>
    </div>

    <!-- HIDDEN ELEMENTS -->
    <input type="file" id="fileInput" accept="image/*">

    <script>
        // IMAGE EDITOR STATE
        const state = {
            originalImage: null,
            canvas: document.getElementById('canvas'),
            ctx: null,
            currentFilter: 'none',
            adjustments: {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0,
                blur: 0
            },
            quality: 1,
            history: [],
            isDrawing: false,
            currentTool: 'select',
            bgRemovalMode: 'color',
            textElements: [],
            activeTextElement: null,
            isDraggingText: false,
            dragOffset: { x: 0, y: 0 },
            brushColor: '#000000',
            brushSize: 20,
            lastX: 0,
            lastY: 0
        };

        state.ctx = state.canvas.getContext('2d', { willReadFrequently: true });

        // ELEMENTS
        const elements = {
            fileInput: document.getElementById('fileInput'),
            canvas: state.canvas,
            canvasArea: document.getElementById('canvasArea'),
            emptyState: document.getElementById('emptyState'),
            uploadZone: document.getElementById('uploadZone'),
            fileName: document.getElementById('fileName'),
            downloadBtn: document.getElementById('downloadBtn'),
            resetBtn: document.getElementById('resetBtn'),
            controlPanel: document.getElementById('controlPanel'),
            
            // Tools
            toolSelect: document.getElementById('toolSelect'),
            toolFilters: document.getElementById('toolFilters'),
            toolAdjust: document.getElementById('toolAdjust'),
            toolRemove: document.getElementById('toolRemove'),
            toolBrush: document.getElementById('toolBrush'),
            toolText: document.getElementById('toolText'),

            // Filter selector
            filterSelector: document.getElementById('filterSelector'),

            // Adjustment sliders
            brightness: document.getElementById('brightness'),
            contrast: document.getElementById('contrast'),
            saturation: document.getElementById('saturation'),
            hue: document.getElementById('hue'),
            blur: document.getElementById('blur'),

            // Slider value displays
            brightnessValue: document.getElementById('brightnessValue'),
            contrastValue: document.getElementById('contrastValue'),
            saturationValue: document.getElementById('saturationValue'),
            hueValue: document.getElementById('hueValue'),
            blurValue: document.getElementById('blurValue'),

            // Sections
            filtersSection: document.getElementById('filtersSection'),
            adjustmentsSection: document.getElementById('adjustmentsSection'),
            bgRemovalSection: document.getElementById('bgRemovalSection'),
            textSection: document.getElementById('textSection'),
            brushSection: document.getElementById('brushSection'),

            // Background removal
            colorRemoveMode: document.getElementById('colorRemoveMode'),
            brushRemoveMode: document.getElementById('brushRemoveMode'),
            colorToRemove: document.getElementById('colorToRemove'),
            tolerance: document.getElementById('tolerance'),
            applyColorRemove: document.getElementById('applyColorRemove'),
            brushRemoveSize: document.getElementById('brushRemoveSize'),
            toleranceValue: document.getElementById('toleranceValue'),
            brushRemoveSizeValue: document.getElementById('brushRemoveSizeValue'),
            colorPickerSection: document.getElementById('colorPickerSection'),
            brushRemoveSection: document.getElementById('brushRemoveSection'),
            applyBrushRemove: document.getElementById('applyBrushRemove'),

            // Brush tools
            brushSize: document.getElementById('brushSize'),
            brushSizeValue: document.getElementById('brushSizeValue'),
            brushColor: document.getElementById('brushColor'),
            brushColorPreview: document.getElementById('brushColorPreview'),
            brushPresets: document.querySelectorAll('.brush-preset'),
            clearBrushBtn: document.getElementById('clearBrushBtn'),

            // Quality buttons
            qualityButtons: document.querySelectorAll('[data-quality]'),

            // Text tool
            textModal: document.getElementById('textModal'),
            textModalClose: document.getElementById('textModalClose'),
            textInput: document.getElementById('textInput'),
            textColor: document.getElementById('textColor'),
            textSize: document.getElementById('textSize'),
            textSizeValue: document.getElementById('textSizeValue'),
            previewText: document.getElementById('previewText'),
            cancelTextBtn: document.getElementById('cancelTextBtn'),
            applyTextBtn: document.getElementById('applyTextBtn'),
            addTextBtn: document.getElementById('addTextBtn')
        };

        // 30 MÜASİR FİLTR
        const filters = [
            { id: 'none', name: 'Orijinal', desc: 'Heç bir filtr tətbiq edilmədi' },
            { id: 'clarendon', name: 'Clarendon', desc: 'Parlaqlıq və kontrast artırır' },
            { id: 'gingham', name: 'Gingham', desc: 'Yumşaq, vintage effekti' },
            { id: 'moon', name: 'Ay', desc: 'Qara-ağ, ağ rəngləri gücləndirir' },
            { id: 'lark', name: 'Tərəvəz', desc: 'Yaşıl rəngləri gücləndirir' },
            { id: 'reyes', name: 'Reyes', desc: 'Yumşaq, isti sepia tonları' },
            { id: 'juno', name: 'Juno', desc: 'Qırmızı tonları gücləndirir' },
            { id: 'slumber', name: 'Yuxu', desc: 'Doyğunluğu azaldır, mavi tonlar əlavə edir' },
            { id: 'crema', name: 'Crema', desc: 'Zərif, pastel tonlar' },
            { id: 'ludwig', name: 'Ludwig', desc: 'Yüngül kontrast və isti tonlar' },
            { id: 'aden', name: 'Aden', desc: 'Yaşıl və mavi tonlar' },
            { id: 'perpetua', name: 'Perpetua', desc: 'Müasir, təmiz görünüş' },
            { id: 'amaro', name: 'Amaro', desc: 'Parlaqlıq və doyğunluq artırır' },
            { id: 'mayfair', name: 'Mayfair', desc: 'Çiçək tonları, yumşaq fokus' },
            { id: 'rise', name: 'Günəş', desc: 'İsti, qızılı tonlar' },
            { id: 'hudson', name: 'Hudson', desc: 'Soyuq, dramatik tonlar' },
            { id: 'valencia', name: 'Valencia', desc: 'Sepia tonları, parlaqlıq' },
            { id: 'xpro2', name: 'X-Pro II', desc: 'Kontrastlı, canlı rənglər' },
            { id: 'sierra', name: 'Sierra', desc: 'Yumşaq, təbii tonlar' },
            { id: 'willow', name: 'Söyüd', desc: 'Monoxrom, yumşaq fokus' },
            { id: 'lofi', name: 'Lo-Fi', desc: 'Doyğunluq və kontrast artırır' },
            { id: 'earlybird', name: 'Earlybird', desc: 'Köhnə foto effekti' },
            { id: 'brannan', name: 'Brannan', desc: 'Kontrastlı, soyuq tonlar' },
            { id: 'inkwell', name: 'Mürəkkəb', desc: 'Qara-ağ effekti' },
            { id: 'hefe', name: 'Hefe', desc: 'Yüksək kontrast, isti tonlar' },
            { id: 'nashville', name: 'Nashville', desc: 'İsti, yumşaq tonlar' },
            { id: 'sutro', name: 'Sutro', desc: 'Qaranlıq, dramatik tonlar' },
            { id: 'toaster', name: 'Toaster', desc: 'Qızılı, qaranlıq tonlar' },
            { id: 'walden', name: 'Walden', desc: 'Açıq mavi tonlar' },
            { id: 'nineteen77', name: '1977', desc: 'Qırmızı tonlar, parlaqlıq' }
        ];

        // FILTR TƏTBİQ ETMƏ
        function applyFilter() {
            let filterString = '';

            // Filtr təyinatları
            const filterEffects = {
                none: '',
                clarendon: 'contrast(1.2) brightness(1.1) saturate(1.1)',
                gingham: 'sepia(0.3) brightness(1.05)',
                moon: 'grayscale(1) brightness(1.1) contrast(1.1)',
                lark: 'hue-rotate(-10deg) saturate(1.2)',
                reyes: 'sepia(0.4) brightness(1.1) contrast(0.9)',
                juno: 'hue-rotate(-20deg) saturate(1.2) contrast(1.1)',
                slumber: 'saturate(0.5) brightness(1.05) hue-rotate(180deg)',
                crema: 'contrast(0.9) brightness(1.05) saturate(0.8)',
                ludwig: 'contrast(1.05) brightness(1.05) sepia(0.1)',
                aden: 'hue-rotate(20deg) saturate(1.2) brightness(0.95)',
                perpetua: 'contrast(0.9) brightness(1.05)',
                amaro: 'brightness(1.1) saturate(1.3)',
                mayfair: 'contrast(1.1) saturate(1.1)',
                rise: 'sepia(0.2) contrast(1.05) brightness(1.1) saturate(1.2)',
                hudson: 'brightness(1.1) contrast(0.9) saturate(1.2) hue-rotate(180deg)',
                valencia: 'sepia(0.3) brightness(1.05) contrast(1.05)',
                xpro2: 'contrast(1.3) saturate(1.3)',
                sierra: 'contrast(0.8) brightness(1.1) saturate(1.1)',
                willow: 'grayscale(0.5) contrast(0.95) brightness(1.05)',
                lofi: 'saturate(1.1) contrast(1.5)',
                earlybird: 'sepia(0.4) contrast(1.1) brightness(1.05) saturate(1.2)',
                brannan: 'sepia(0.5) contrast(1.4)',
                inkwell: 'grayscale(1) contrast(1.1) brightness(1.05)',
                hefe: 'contrast(1.5) saturate(1.4) brightness(1.05)',
                nashville: 'sepia(0.2) hue-rotate(-15deg) saturate(1.2) contrast(0.9)',
                sutro: 'brightness(0.9) contrast(1.2) saturate(0.8)',
                toaster: 'sepia(0.3) contrast(1.5) brightness(0.9)',
                walden: 'brightness(1.1) hue-rotate(10deg) saturate(1.6)',
                nineteen77: 'sepia(0.3) hue-rotate(-10deg) saturate(1.4) contrast(1.1)'
            };

            filterString += filterEffects[state.currentFilter] || '';

            // Düzəlişlər
            const brightness = 1 + state.adjustments.brightness / 100;
            const contrast = 1 + state.adjustments.contrast / 100;
            const saturation = 1 + state.adjustments.saturation / 100;
            const hue = state.adjustments.hue;

            filterString += ` brightness(${brightness}) contrast(${contrast}) saturate(${saturation}) hue-rotate(${hue}deg) blur(${state.adjustments.blur}px)`;

            state.ctx.filter = filterString;
        }

        // SHOW TOAST
        function showToast(message, isError = false, isWarning = false) {
            const toast = document.createElement('div');
            toast.className = `toast ${isError ? 'error' : isWarning ? 'warning' : ''}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // FILE UPLOAD
        elements.fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    state.originalImage = img;
                    const maxWidth = window.innerWidth * 0.7;
                    const maxHeight = window.innerHeight * 0.8;
                    
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }

                    state.canvas.width = width;
                    state.canvas.height = height;
                    
                    elements.fileName.textContent = file.name;
                    elements.canvas.classList.remove('hidden');
                    elements.emptyState.classList.add('hidden');
                    elements.downloadBtn.disabled = false;
                    elements.resetBtn.disabled = false;

                    // Reset adjustments
                    resetAdjustments();
                    
                    redrawCanvas();
                    showToast('✓ Şəkil uğurla yükləndi');
                };
                img.src = event.target.result;
            };
            reader.onerror = () => {
                showToast('✗ Şəkil yüklənərkən xəta baş verdi', true);
            };
            reader.readAsDataURL(file);
        });

        // DRAG AND DROP
        elements.uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.add('active');
        });

        elements.uploadZone.addEventListener('dragleave', () => {
            elements.uploadZone.classList.remove('active');
        });

        elements.uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.uploadZone.classList.remove('active');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                elements.fileInput.files = e.dataTransfer.files;
                elements.fileInput.dispatchEvent(new Event('change'));
            } else {
                showToast('✗ Yalnız şəkil faylları qəbul edilir', true);
            }
        });

        // RESET ADJUSTMENTS
        function resetAdjustments() {
            state.adjustments = {
                brightness: 0,
                contrast: 0,
                saturation: 0,
                hue: 0,
                blur: 0
            };
            
            state.currentFilter = 'none';
            
            // Reset sliders
            elements.brightness.value = 0;
            elements.contrast.value = 0;
            elements.saturation.value = 0;
            elements.hue.value = 0;
            elements.blur.value = 0;
            
            // Reset slider displays
            elements.brightnessValue.textContent = '0';
            elements.contrastValue.textContent = '0';
            elements.saturationValue.textContent = '0';
            elements.hueValue.textContent = '0';
            elements.blurValue.textContent = '0';
            
            // Reset filter buttons
            document.querySelectorAll('.filter-option').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === 'none') {
                    btn.classList.add('active');
                }
            });
            
            // Reset text elements
            state.textElements = [];
            state.activeTextElement = null;
            
            redrawCanvas();
        }

        // REDRAW CANVAS
        function redrawCanvas() {
            if (!state.originalImage) return;

            state.ctx.clearRect(0, 0, state.canvas.width, state.canvas.height);

            // Apply filter
            applyFilter();

            // Draw image
            state.ctx.drawImage(state.originalImage, 0, 0, state.canvas.width, state.canvas.height);

            // Draw text elements
            drawTextElements();

            // Add watermark (HƏR ZAMAN QALSIN)
            state.ctx.font = 'bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
            state.ctx.fillStyle = 'rgba(241, 245, 249, 0.4)';
            state.ctx.textAlign = 'right';
            state.ctx.fillText('AxtarGet', state.canvas.width - 10, state.canvas.height - 10);
        }

        // DRAW TEXT ELEMENTS
        function drawTextElements() {
            state.textElements.forEach(text => {
                state.ctx.font = `${text.size}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;
                state.ctx.fillStyle = text.color;
                state.ctx.textAlign = 'left';
                state.ctx.textBaseline = 'top';
                
                // Draw text
                state.ctx.fillText(text.content, text.x, text.y);
                
                // Draw selection border if active
                if (text === state.activeTextElement) {
                    const textMetrics = state.ctx.measureText(text.content);
                    const textWidth = textMetrics.width;
                    const textHeight = parseInt(text.size);
                    
                    state.ctx.strokeStyle = '#3B82F6';
                    state.ctx.lineWidth = 2;
                    state.ctx.strokeRect(text.x - 5, text.y - 5, textWidth + 10, textHeight + 10);
                    
                    // Draw resize handle
                    state.ctx.fillStyle = '#3B82F6';
                    state.ctx.fillRect(text.x + textWidth - 5, text.y + textHeight - 5, 10, 10);
                }
            });
        }

        // TOOL SELECTION
        function setActiveTool(tool) {
            // Remove active class from all tools
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected tool
            document.getElementById(`tool${tool.charAt(0).toUpperCase() + tool.slice(1)}`).classList.add('active');
            
            state.currentTool = tool;
            
            // Update cursor
            switch(tool) {
                case 'select':
                    state.canvas.style.cursor = 'default';
                    break;
                case 'brush':
                    state.canvas.style.cursor = 'crosshair';
                    break;
                case 'text':
                    state.canvas.style.cursor = 'text';
                    break;
                case 'remove':
                    state.canvas.style.cursor = state.bgRemovalMode === 'brush' ? 'crosshair' : 'default';
                    break;
                default:
                    state.canvas.style.cursor = 'default';
            }
            
            // Show/hide appropriate panels
            elements.filtersSection.classList.add('hidden');
            elements.adjustmentsSection.classList.add('hidden');
            elements.bgRemovalSection.classList.add('hidden');
            elements.textSection.classList.add('hidden');
            elements.brushSection.classList.add('hidden');
            
            switch(tool) {
                case 'filters':
                    elements.filtersSection.classList.remove('hidden');
                    break;
                case 'adjust':
                    elements.adjustmentsSection.classList.remove('hidden');
                    break;
                case 'remove':
                    elements.bgRemovalSection.classList.remove('hidden');
                    break;
                case 'text':
                    elements.textSection.classList.remove('hidden');
                    break;
                case 'brush':
                    elements.brushSection.classList.remove('hidden');
                    break;
            }
        }

        // FILTER BUTTONS
        function createFilterButtons() {
            elements.filterSelector.innerHTML = '';
            
            filters.forEach(filter => {
                const button = document.createElement('button');
                button.className = `filter-option ${filter.id === 'none' ? 'active' : ''}`;
                button.dataset.filter = filter.id;
                button.innerHTML = `
                    <div class="filter-name">${filter.name}</div>
                    <div class="filter-desc">${filter.desc}</div>
                `;
                
                button.addEventListener('click', () => {
                    // Remove active class from all filter buttons
                    document.querySelectorAll('.filter-option').forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Update filter
                    state.currentFilter = filter.id;
                    redrawCanvas();
                });
                
                elements.filterSelector.appendChild(button);
            });
        }

        // ADJUSTMENT SLIDERS
        function setupSlider(slider, valueDisplay, property) {
            slider.addEventListener('input', () => {
                state.adjustments[property] = parseInt(slider.value);
                valueDisplay.textContent = slider.value;
                redrawCanvas();
            });
        }

        setupSlider(elements.brightness, elements.brightnessValue, 'brightness');
        setupSlider(elements.contrast, elements.contrastValue, 'contrast');
        setupSlider(elements.saturation, elements.saturationValue, 'saturation');
        setupSlider(elements.hue, elements.hueValue, 'hue');
        setupSlider(elements.blur, elements.blurValue, 'blur');

        // BRUSH TOOLS
        elements.brushSize.addEventListener('input', () => {
            state.brushSize = parseInt(elements.brushSize.value);
            elements.brushSizeValue.textContent = state.brushSize;
        });

        elements.brushColor.addEventListener('input', () => {
            state.brushColor = elements.brushColor.value;
            elements.brushColorPreview.style.backgroundColor = state.brushColor;
        });

        elements.brushPresets.forEach(preset => {
            preset.addEventListener('click', () => {
                elements.brushPresets.forEach(p => p.classList.remove('active'));
                preset.classList.add('active');
                state.brushColor = preset.dataset.color;
                elements.brushColor.value = state.brushColor;
                elements.brushColorPreview.style.backgroundColor = state.brushColor;
            });
        });

        // BRUSH DRAWING
        function startDrawing(e) {
            if (state.currentTool !== 'brush' || !state.originalImage) return;
            
            state.isDrawing = true;
            const rect = state.canvas.getBoundingClientRect();
            state.lastX = e.clientX - rect.left;
            state.lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!state.isDrawing || state.currentTool !== 'brush' || !state.originalImage) return;
            
            const rect = state.canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            state.ctx.beginPath();
            state.ctx.moveTo(state.lastX, state.lastY);
            state.ctx.lineTo(currentX, currentY);
            state.ctx.strokeStyle = state.brushColor;
            state.ctx.lineWidth = state.brushSize;
            state.ctx.lineCap = 'round';
            state.ctx.lineJoin = 'round';
            state.ctx.stroke();
            
            state.lastX = currentX;
            state.lastY = currentY;
        }

        function stopDrawing() {
            state.isDrawing = false;
        }

        // BRUSH EVENT LISTENERS
        state.canvas.addEventListener('mousedown', startDrawing);
        state.canvas.addEventListener('mousemove', draw);
        state.canvas.addEventListener('mouseup', stopDrawing);
        state.canvas.addEventListener('mouseout', stopDrawing);

        // TOUCH EVENTS FOR MOBILE
        state.canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            state.canvas.dispatchEvent(mouseEvent);
        });

        state.canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            state.canvas.dispatchEvent(mouseEvent);
        });

        state.canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            state.canvas.dispatchEvent(mouseEvent);
        });

        // CLEAR BRUSH
        elements.clearBrushBtn.addEventListener('click', () => {
            if (!state.originalImage) {
                showToast('✗ Əvvəlcə şəkil yükləyin', true);
                return;
            }
            
            redrawCanvas();
            showToast('✓ Fırça işləri təmizləndi');
        });

        // BACKGROUND REMOVAL MODE
        elements.colorRemoveMode.addEventListener('click', () => {
            elements.colorRemoveMode.classList.add('active');
            elements.brushRemoveMode.classList.remove('active');
            elements.colorPickerSection.classList.remove('hidden');
            elements.brushRemoveSection.classList.add('hidden');
            state.bgRemovalMode = 'color';
            state.canvas.style.cursor = 'default';
        });

        elements.brushRemoveMode.addEventListener('click', () => {
            elements.brushRemoveMode.classList.add('active');
            elements.colorRemoveMode.classList.remove('active');
            elements.colorPickerSection.classList.add('hidden');
            elements.brushRemoveSection.classList.remove('hidden');
            state.bgRemovalMode = 'brush';
            state.canvas.style.cursor = 'crosshair';
        });

        // BRUSH SIZE FOR BACKGROUND REMOVAL
        elements.brushRemoveSize.addEventListener('input', () => {
            elements.brushRemoveSizeValue.textContent = elements.brushRemoveSize.value;
        });

        // APPLY COLOR REMOVAL
        elements.applyColorRemove.addEventListener('click', () => {
            if (!state.originalImage) {
                showToast('✗ Əvvəlcə şəkil yükləyin', true);
                return;
            }

            const color = elements.colorToRemove.value;
            const tolerance = parseInt(elements.tolerance.value);
            
            // Convert hex to RGB
            const r = parseInt(color.substr(1, 2), 16);
            const g = parseInt(color.substr(3, 2), 16);
            const b = parseInt(color.substr(5, 2), 16);
            
            // Get image data
            const imageData = state.ctx.getImageData(0, 0, state.canvas.width, state.canvas.height);
            const data = imageData.data;
            
            // Remove background color
            for (let i = 0; i < data.length; i += 4) {
                const pixelR = data[i];
                const pixelG = data[i + 1];
                const pixelB = data[i + 2];
                
                // Calculate color distance
                const distance = Math.sqrt(
                    Math.pow(pixelR - r, 2) +
                    Math.pow(pixelG - g, 2) +
                    Math.pow(pixelB - b, 2)
                );
                
                // If color is within tolerance, make it transparent
                if (distance < tolerance) {
                    data[i + 3] = 0; // Set alpha to 0
                }
            }
            
            // Put image data back
            state.ctx.putImageData(imageData, 0, 0);
            showToast('✓ Fon uğurla silindi');
        });

        // TEXT TOOL
        elements.toolText.addEventListener('click', () => {
            setActiveTool('text');
        });

        elements.addTextBtn.addEventListener('click', () => {
            elements.textModal.classList.remove('hidden');
        });

        elements.textModalClose.addEventListener('click', () => {
            elements.textModal.classList.add('hidden');
        });

        elements.cancelTextBtn.addEventListener('click', () => {
            elements.textModal.classList.add('hidden');
        });

        elements.textInput.addEventListener('input', () => {
            elements.previewText.textContent = elements.textInput.value || 'Mətn Önizləmə';
        });

        elements.textColor.addEventListener('input', () => {
            elements.previewText.style.color = elements.textColor.value;
        });

        elements.textSize.addEventListener('input', () => {
            const size = elements.textSize.value;
            elements.textSizeValue.textContent = `${size}px`;
            elements.previewText.style.fontSize = `${size}px`;
        });

        elements.applyTextBtn.addEventListener('click', () => {
            const text = elements.textInput.value.trim();
            if (!text) {
                showToast('✗ Mətn daxil edin', true);
                return;
            }

            const textElement = {
                content: text,
                color: elements.textColor.value,
                size: parseInt(elements.textSize.value),
                x: state.canvas.width / 2 - 50,
                y: state.canvas.height / 2 - 20
            };

            state.textElements.push(textElement);
            state.activeTextElement = textElement;
            
            elements.textModal.classList.add('hidden');
            redrawCanvas();
            showToast('✓ Mətn uğurla əlavə edildi');
        });

        // CANVAS CLICK FOR TEXT SELECTION
        state.canvas.addEventListener('mousedown', (e) => {
            if (state.currentTool !== 'text' || !state.textElements.length) return;
            
            const rect = state.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if clicked on a text element
            for (let i = state.textElements.length - 1; i >= 0; i--) {
                const text = state.textElements[i];
                state.ctx.font = `${text.size}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;
                const textMetrics = state.ctx.measureText(text.content);
                const textWidth = textMetrics.width;
                const textHeight = parseInt(text.size);
                
                if (x >= text.x - 5 && x <= text.x + textWidth + 5 && 
                    y >= text.y - 5 && y <= text.y + textHeight + 5) {
                    
                    state.activeTextElement = text;
                    state.isDraggingText = true;
                    state.dragOffset.x = x - text.x;
                    state.dragOffset.y = y - text.y;
                    redrawCanvas();
                    return;
                }
            }
            
            // If clicked outside any text, deselect
            state.activeTextElement = null;
            redrawCanvas();
        });

        state.canvas.addEventListener('mousemove', (e) => {
            if (state.currentTool !== 'text' || !state.isDraggingText || !state.activeTextElement) return;
            
            const rect = state.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            state.activeTextElement.x = x - state.dragOffset.x;
            state.activeTextElement.y = y - state.dragOffset.y;
            
            redrawCanvas();
        });

        state.canvas.addEventListener('mouseup', () => {
            state.isDraggingText = false;
        });

        // QUALITY SETTINGS
        elements.qualityButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                elements.qualityButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.quality = parseFloat(btn.dataset.quality);
            });
        });

        // RESET BUTTON
        elements.resetBtn.addEventListener('click', () => {
            if (!state.originalImage) return;
            
            resetAdjustments();
            showToast('✓ Bütün dəyişikliklər sıfırlandı');
        });

        // DOWNLOAD BUTTON
        elements.downloadBtn.addEventListener('click', () => {
            if (!state.originalImage) {
                showToast('✗ Endirmək üçün şəkil yoxdur', true);
                return;
            }

            // Create temporary canvas for download
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = state.canvas.width;
            tempCanvas.height = state.canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Apply current filters and adjustments
            tempCtx.filter = state.ctx.filter;
            tempCtx.drawImage(state.originalImage, 0, 0, tempCanvas.width, tempCanvas.height);
            
            // Draw text elements
            state.textElements.forEach(text => {
                tempCtx.font = `${text.size}px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif`;
                tempCtx.fillStyle = text.color;
                tempCtx.textAlign = 'left';
                tempCtx.textBaseline = 'top';
                tempCtx.fillText(text.content, text.x, text.y);
            });
            
            // Add watermark (HƏR ZAMAN QALSIN)
            tempCtx.font = 'bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
            tempCtx.fillStyle = 'rgba(241, 245, 249, 0.4)';
            tempCtx.textAlign = 'right';
            tempCtx.fillText('AxtarGet', tempCanvas.width - 10, tempCanvas.height - 10);
            
            // Create download link
            const link = document.createElement('a');
            link.download = `edited-${elements.fileName.textContent || 'image'}.jpg`;
            link.href = tempCanvas.toDataURL('image/jpeg', state.quality);
            link.click();
            
            showToast('✓ Şəkil uğurla endirildi');
        });

        // TOOL BUTTON CLICKS
        elements.toolSelect.addEventListener('click', () => setActiveTool('select'));
        elements.toolFilters.addEventListener('click', () => setActiveTool('filters'));
        elements.toolAdjust.addEventListener('click', () => setActiveTool('adjust'));
        elements.toolBrush.addEventListener('click', () => setActiveTool('brush'));
        elements.toolRemove.addEventListener('click', () => setActiveTool('remove'));
        elements.toolText.addEventListener('click', () => setActiveTool('text'));

        // INITIALIZE
        function init() {
            // Create filter buttons
            createFilterButtons();
            
            // Set initial tool
            setActiveTool('select');
            
            // Set initial slider values
            elements.brightnessValue.textContent = elements.brightness.value;
            elements.contrastValue.textContent = elements.contrast.value;
            elements.saturationValue.textContent = elements.saturation.value;
            elements.hueValue.textContent = elements.hue.value;
            elements.blurValue.textContent = elements.blur.value;
            elements.toleranceValue.textContent = elements.tolerance.value;
            elements.brushSizeValue.textContent = elements.brushSize.value;
            elements.brushRemoveSizeValue.textContent = elements.brushRemoveSize.value;
            elements.textSizeValue.textContent = `${elements.textSize.value}px`;
            
            // Set initial brush color
            elements.brushColorPreview.style.backgroundColor = state.brushColor;
            
            showToast('AxtarGet Professional Şəkil Redaktoruna xoş gəlmisiniz!', false, true);
        }

        // Start the application
        init();
    </script>
</body>
</html>
