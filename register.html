<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AxtarGet Bot - Qeydiyyat</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Tünd qara/boz fon */
            color: #e2e8f0; /* Kontrast üçün açıq boz mətn */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .gradient-bg {
            background-image: linear-gradient(to right, #10b981, #34d399); /* Yaşıldan açıq yaşıl qradiyent */
        }
        .form-container {
            background-color: #2d3748;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.25);
            max-width: 450px;
            width: 90%;
            border: 1px solid #10b981;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #4a5568;
            color: #e2e8f0;
            border: 1px solid #6b7280;
            focus:outline-none focus:ring-2 focus:ring-green-500;
        }
        .submit-button {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #10b981;
            color: white;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .submit-button:hover {
            background-color: #059669;
        }
        .link-text {
            color: #34d399;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .link-text:hover {
            color: #10b981;
        }
        .alert-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #dc2626; /* Red background */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .alert-message.show {
            opacity: 1;
        }
    </style>
</head>
<body class="relative">

    <div class="form-container">
        <h2 class="text-3xl font-bold text-center text-white mb-8">Qeydiyyat</h2>
        <form id="register-form" class="space-y-5">
            <div>
                <label for="username" class="block text-white text-lg font-semibold mb-2">İstifadəçi Adı</label>
                <input type="text" id="username" placeholder="İstifadəçi Adınız" class="input-field">
            </div>
            <div>
                <label for="email" class="block text-white text-lg font-semibold mb-2">E-poçt</label>
                <input type="email" id="email" placeholder="E-poçt ünvanınız" class="input-field">
            </div>
            <div>
                <label for="password" class="block text-white text-lg font-semibold mb-2">Şifrə</label>
                <input type="password" id="password" placeholder="Şifrəniz" class="input-field">
            </div>
            <div>
                <label for="confirm-password" class="block text-white text-lg font-semibold mb-2">Şifrəni Təkrar Yazın</label>
                <input type="password" id="confirm-password" placeholder="Şifrənizi təkrar yazın" class="input-field">
            </div>
            <button type="submit" id="register-submit-btn" class="submit-button">Qeydiyyatdan Keç</button>
        </form>
        <div id="loading-indicator" class="hidden mt-4 text-center text-green-400">
            <i class="fas fa-spinner fa-spin mr-2"></i> Qeydiyyat aparılır...
        </div>
        <p class="text-center text-gray-400 mt-6">
            Artıq hesabınız var? <a href="share-business.html" class="link-text">Daxil Olun</a>
        </p>
    </div>

    <div id="alert-container"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Firebase konfiqurasiyası
        const firebaseConfig = {
            apiKey: "AIzaSyBEFLX4Uy4jTzoSyEdzYzOSEd2lqn8ifbE",
            authDomain: "axtargetbotwebsite.firebaseapp.com",
            projectId: "axtargetbotwebsite",
            storageBucket: "axtargetbotwebsite.firebasestorage.app",
            messagingSenderId: "808698399196",
            appId: "1:808698399196:web:61b6be0721b94f24c3a719",
            measurementId: "G-VLWZG4Q5TD"
        };
        const firebaseProjectId = firebaseConfig.projectId;

        // Firebase-i Başlat
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM elementləri
        const registerForm = document.getElementById('register-form');
        const usernameInput = document.getElementById('username');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const registerSubmitBtn = document.getElementById('register-submit-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const alertContainer = document.getElementById('alert-container');

        // Custom alert funksiyası
        function showAlert(message, type = 'error') {
            const alertBox = document.createElement('div');
            alertBox.className = `alert-message ${type} fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white p-3 rounded-lg shadow-md z-50`;
            alertBox.textContent = message;
            
            // Mövcud alertləri silin (təkrar görünüşlərin qarşısını almaq üçün)
            const existingAlerts = document.querySelectorAll('.alert-message');
            existingAlerts.forEach(alert => alert.remove());

            if (type === 'success') {
                alertBox.classList.remove('bg-red-600');
                alertBox.classList.add('bg-green-600');
            }
            alertContainer.appendChild(alertBox);
            setTimeout(() => {
                alertBox.classList.add('show');
            }, 10);
            setTimeout(() => {
                alertBox.classList.remove('show');
                alertBox.addEventListener('transitionend', () => alertBox.remove(), { once: true });
            }, 3000);
        }

        // Qeydiyyat Formu göndərilmə hadisəsi
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = usernameInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            const confirmPassword = confirmPasswordInput.value.trim();

            if (!username || !email || !password || !confirmPassword) {
                showAlert("Bütün sahələri doldurun.", 'error');
                return;
            }
            if (password.length < 6) {
                showAlert("Şifrə ən azı 6 simvol olmalıdır.", 'error');
                return;
            }
            if (password !== confirmPassword) {
                showAlert("Şifrələr uyğun gəlmir.", 'error');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            registerSubmitBtn.disabled = true;
            registerSubmitBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                // Firebase Autentifikasiya ilə istifadəçi yarat
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Firestore-a istifadəçi adı əlavə et (users kolleksiyasında)
                await setDoc(doc(db, `users`, user.uid), {
                    username: username,
                    email: email,
                    createdAt: new Date()
                });

                showAlert("Uğurla qeydiyyatdan keçdiniz! Yönləndirilirsiniz...", 'success');
                // Qısa gecikmə ilə yönləndir
                setTimeout(() => {
                    window.location.href = 'share-business.html'; // Biznes paylaşım səhifəsinə yönləndir
                }, 1000); // 1 saniyə gecikmə

            } catch (error) {
                console.error("Qeydiyyat xətası:", error);
                if (error.code === 'auth/email-already-in-use') {
                    showAlert("Bu e-poçt ünvanı artıq istifadə olunur. Zəhmət olmasa, giriş edin.", 'error');
                } else if (error.code === 'auth/weak-password') {
                    showAlert("Şifrə çox zəifdir. Daha güclü bir şifrə seçin.", 'error');
                } else if (error.code === 'auth/invalid-email') {
                    showAlert("Yanlış e-poçt formatı.", 'error');
                }
                else {
                    showAlert("Qeydiyyat zamanı xəta baş verdi: " + error.message, 'error');
                }
            } finally {
                loadingIndicator.classList.add('hidden');
                registerSubmitBtn.disabled = false;
                registerSubmitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });
    </script>
</body>
</html>
